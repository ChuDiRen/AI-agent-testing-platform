# AI 自动生成测试用例 - 快速启动指南

## 功能特性

✨ **ChatGPT风格的对话式界面**：像与测试专家聊天一样生成测试用例
🤖 **多模型支持**：DeepSeek、通义千问、ChatGPT等10+主流AI模型
📝 **可配置提示词**：4种测试类型（API/Web/App/通用）的提示词模板
💬 **多轮对话**：支持追加需求、调整参数、持续对话
⚡ **实时流式输出**：边生成边展示，无需等待
💾 **会话管理**：保存、恢复、切换对话历史
📋 **批量保存**：一键保存AI生成的所有测试用例
🔄 **双格式支持**：JSON和YAML两种格式可选

## 5 分钟快速开始

### 步骤 1: 初始化系统（首次使用）

```bash
cd platform-fastapi-server
python core/init_data.py
```

**初始化内容:**
- ✅ 10 个 AI 模型配置（默认禁用）
- ✅ 4 个提示词模板（API/Web/App/通用）
- ✅ 测试用户和基础数据
- ✅ AI功能菜单权限

### 步骤 2: 启动服务

**后端服务:**
```bash
cd platform-fastapi-server
python run.py
```
服务将在 `http://localhost:5000` 启动

**前端服务:**
```bash
cd platform-vue-web
pnpm install  # 首次运行需要安装依赖
pnpm dev
```
服务将在 `http://localhost:5173` 启动

### 步骤 3: 配置 AI 模型

#### 方式 A: 通过Web界面配置（推荐）

1. 访问 http://localhost:5173/#/login
2. 使用默认账号登录：`admin` / `admin123`
3. 进入 **AI配置 > AI模型管理**
4. 编辑DeepSeek模型：
   - 访问 https://platform.deepseek.com/api_keys 获取API Key
   - 输入API Key
   - 启用模型
   - 测试连接
5. 点击保存

#### 方式 B: 通过Swagger API配置

1. 访问 http://localhost:5000/docs
2. 找到 `PUT /AiModel/{model_id}` 接口
3. 点击 "Try it out"
4. 输入配置（model_id填1表示DeepSeek）:

```json
{
  "api_key": "sk-your-deepseek-key-here",
  "is_enabled": true
}
```

5. 点击 "Execute"

### 步骤 4: 开始使用AI测试助手

1. 登录系统后，进入 **API自动化 > AI测试助手**
2. 点击"新建对话"创建新的测试会话
3. 选择测试类型（API/Web/App/通用）
4. 在输入框中输入需求，例如：
   ```
   我需要为用户登录功能生成5个测试用例，包括正常登录、密码错误、账号不存在等场景
   ```
5. 点击发送或按Enter键
6. AI会实时流式输出测试用例
7. 查看生成的测试用例，可以：
   - ✏️ 编辑修改用例内容
   - 💾 保存到测试用例库
   - 📋 复制用例内容
   - 🔄 切换JSON/YAML格式
8. 继续对话，追加需求或调整参数：
   ```
   再增加3个关于并发登录的用例
   ```

### 高级功能

#### 📁 会话管理
- **保存会话**：对话会自动保存，下次可继续
- **切换会话**：左侧边栏查看和切换历史对话
- **重命名会话**：双击会话标题可重命名
- **删除会话**：右键菜单删除不需要的对话

#### 📂 文件上传
- 支持上传需求文档（TXT/Word/PDF）
- AI会根据文档内容生成测试用例
- 点击输入框旁的📎图标选择文件

#### ⚡ 快捷命令
在输入框中输入以下命令：
- `/generate 10` - 生成10个测试用例
- `/format yaml` - 切换为YAML格式输出
- `/save` - 保存当前所有用例
- `/clear` - 清空当前对话

#### 🎨 自定义提示词
1. 进入 **AI配置 > 提示词模板管理**
2. 编辑现有模板或创建新模板
3. 支持变量替换：`{case_count}`、`{test_type}`等
4. 激活模板后，AI对话中会自动使用

## 常见问题

### Q1: AI响应速度慢怎么办？
A: 检查网络连接，或切换到响应更快的AI模型（如DeepSeek）

### Q2: 如何批量保存所有测试用例？
A: 在对话界面右上角点击"批量保存"按钮，所有生成的用例会一次性保存到测试用例库

### Q3: 可以使用自己的AI模型吗？
A: 可以！在AI模型管理页面添加自定义模型，填写API地址和Key即可

### Q4: 提示词模板如何自定义？
A: 进入提示词模板管理，编辑system类型的模板，可以调整AI的生成风格和要求

### Q5: 如何导出测试用例为YAML格式？
A: 在测试用例管理页面，选择用例后点击"导出YAML"按钮

## 支持的AI模型

系统已预配置以下AI模型（需配置API Key）：

1. **DeepSeek** - 推荐，高性价比
2. **通义千问** - 阿里云，新用户免费
3. **文心一言** - 百度AI
4. **ChatGPT-4/3.5** - OpenAI
5. **Kimi** - 月之暗面，长文本支持
6. **智谱AI GLM-4** - 清华系AI
7. **讯飞星火** - 科大讯飞
8. **Claude-3** - Anthropic

#### 通义千问配置（阿里云，新用户免费）

1. 访问 https://bailian.console.aliyun.com/?tab=model#/api-key
2. 使用支付宝账号登录
3. 创建 API Key（新用户送百万 tokens）
4. 访问 http://localhost:8000/docs
5. 找到 `PUT /api/v1/ai/models/2` 接口（通义千问 Turbo）
6. 输入配置:

```json
{
  "api_key": "sk-your-qwen-key-here",
  "is_enabled": true
}
```

**注意**: 如果需要更强性能，可以配置：
- 通义千问 Plus (模型ID: 3)
- 通义千问 Max (模型ID: 4)

### 步骤 4: 启动前端服务

```bash
cd AI-agent-frontend-vue3
pnpm install   # 首次运行需要安装依赖
pnpm dev
```

前端将在 `http://localhost:5173` 启动

### 步骤 5: 使用 AI 生成测试用例

1. 访问 http://localhost:5173
2. 登录系统:
   - 用户名: `BNTang`
   - 密码: `1234qwer`
3. 进入「测试用例管理」页面
4. 点击**「AI 生成」**按钮
5. 在弹出的对话框中:
   - 选择 AI 模型（DeepSeek Chat 或 通义千问 Turbo）
   - 选择测试类型（API/Web/App）
   - 输入模块名称（例如：用户管理）
   - 输入需求描述或上传文件
   - 设置生成数量（1-20）
6. 点击**「开始生成」**
7. 等待 AI 生成（通常 5-15 秒）
8. 预览生成的测试用例
9. 选择要保存的用例
10. 点击**「保存选中的用例」**

完成！测试用例已自动添加到列表中。

## 示例需求描述

### API 测试用例示例

```
用户登录接口需求：

接口地址: POST /api/v1/auth/login

功能描述:
提供用户登录功能，支持用户名密码登录和手机号验证码登录两种方式。

接口参数:
- username: 用户名（字符串，必填）
- password: 密码（字符串，必填）
- login_type: 登录类型（password/sms，默认 password）
- phone: 手机号（登录类型为 sms 时必填）
- code: 验证码（登录类型为 sms 时必填）
- remember_me: 记住我（布尔值，可选）

返回数据:
{
  "access_token": "jwt token",
  "refresh_token": "refresh token",
  "user_info": {
    "user_id": 1,
    "username": "admin",
    "email": "admin@example.com"
  }
}

业务规则:
1. 密码连续错误 3 次锁定账户 10 分钟
2. 验证码 5 分钟内有效
3. remember_me 为 true 时，token 有效期 7 天
4. 成功登录后清除错误计数

错误码:
- 401: 用户名或密码错误
- 403: 账户已被锁定
- 400: 参数错误
- 404: 用户不存在
```

### Web 测试用例示例

```
用户注册页面需求：

页面路径: /register

功能描述:
提供新用户注册功能，收集用户基本信息并创建账户。

页面元素:
1. 用户名输入框（必填，3-20 字符，只能包含字母数字下划线）
2. 邮箱输入框（必填，有效邮箱格式）
3. 密码输入框（必填，至少 8 位，包含大小写字母和数字）
4. 确认密码输入框（必填，需与密码一致）
5. 手机号输入框（必填，11 位中国手机号）
6. 获取验证码按钮（60 秒倒计时）
7. 验证码输入框（必填，6 位数字）
8. 用户协议复选框（必填）
9. 注册按钮
10. 返回登录链接

交互规则:
1. 实时验证输入格式
2. 密码强度显示（弱/中/强）
3. 邮箱和用户名唯一性检查
4. 验证码倒计时 60 秒
5. 所有字段验证通过后注册按钮才可用
6. 注册成功后跳转到登录页

错误提示:
- 各字段的实时验证提示
- 用户名已存在提示
- 邮箱已注册提示
- 验证码错误提示
- 网络错误提示
```

### App 测试用例示例

```
移动端商品搜索功能需求：

功能模块: 商品搜索

功能描述:
用户可以通过关键词搜索商品，支持历史记录和热门搜索推荐。

功能点:
1. 搜索框
   - 支持文本输入
   - 支持语音输入
   - 支持扫码搜索

2. 搜索建议
   - 输入时实时显示建议
   - 最多显示 10 条建议
   - 点击建议直接搜索

3. 搜索历史
   - 保存最近 20 条搜索记录
   - 可删除单条历史
   - 可清空全部历史

4. 热门搜索
   - 显示平台热搜榜前 10
   - 实时更新
   - 点击可直接搜索

5. 搜索结果
   - 综合排序/销量排序/价格排序
   - 支持筛选（价格区间、品牌、分类）
   - 下拉刷新
   - 上拉加载更多

6. 无结果处理
   - 显示"暂无相关商品"
   - 推荐相似商品
   - 推荐热门商品

平台要求:
- 支持 iOS 13+ 和 Android 8+
- 适配不同屏幕尺寸
- 支持深色模式
- 离线时显示历史记录
```

## 常见问题

### Q: 生成的测试用例不够详细？

**解决方案:**
1. 提供更详细的需求描述（包括接口信息、业务规则等）
2. 使用更强大的模型（通义千问 Plus 或 Max）
3. 增加生成数量（10-15个），从中选择最好的
4. 使用或自定义专业的提示词模板
5. 在预览时手动编辑完善

### Q: API Key 配置后还是无法使用？

**检查清单:**
- [ ] API Key 格式是否正确
- [ ] 模型是否已启用 (is_enabled: true)
- [ ] API Key 是否有余额（DeepSeek 需要充值）
- [ ] 网络是否正常
- [ ] 查看后端日志 `AI-agent-backend-fastapi/logs/app.log`

### Q: 文件上传失败？

**解决方案:**
1. 确认文件格式（支持 TXT/Word/PDF）
2. 检查文件大小（建议 < 10MB）
3. 确保文件内容不为空
4. 尝试使用文本输入方式

### Q: 想要自定义提示词？

**两种方式:**

**方式 1: 创建提示词模板**
```bash
POST /api/v1/prompt-templates
{
  "name": "我的自定义模板",
  "template_type": "testcase_generation",
  "test_type": "API",
  "content": "你的提示词内容..."
}
```

**方式 2: 临时使用**
- 在生成对话框中勾选"使用自定义提示词"
- 直接输入提示词

## 下一步

- 📖 查看详细文档: `AI-agent-backend-fastapi/AI_TESTCASE_GENERATION.md`
- 💡 优化提示词模板: 访问 `/api/v1/prompt-templates`
- 🎯 配置多个 AI 模型: 同时配置 DeepSeek 和通义千问，根据需求选择使用
- 🔧 自定义模板: 创建适合团队的提示词模板

## 技术支持

如遇问题，请查看:
1. 后端日志: `AI-agent-backend-fastapi/logs/app.log`
2. API 文档: http://localhost:8000/docs
3. 浏览器控制台

---

**💡 推荐配置**: 
- **新手首选**: 通义千问 Turbo（免费额度，快速响应）
- **性价比之选**: DeepSeek Chat（费用极低，质量不错）
- **追求质量**: 通义千问 Max（最强性能，适合复杂需求）

**🎯 使用技巧**:
1. 第一次使用建议生成 10-15 个用例，从中挑选最好的
2. 需求描述越详细，生成质量越高
3. 可以同时配置多个模型，根据场景切换使用

