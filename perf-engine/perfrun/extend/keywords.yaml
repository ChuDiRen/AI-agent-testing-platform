# Perf Engine 关键字配置文件
# 基于 Locust 性能测试框架语法设计

# ================================
# 用户行为配置关键字
# 对应 Locust: HttpUser, wait_time, weight
# ================================
user_config:
  - wait_time        # 等待时间策略: between(1,3) | constant(2) | constant_pacing(5)
  - weight           # 用户权重 (多用户场景)
  - host             # 目标主机 (覆盖全局配置)

# ================================
# HTTP 请求关键字
# 对应 Locust: self.client.get/post/put/delete
# ================================
get:
  - url              # 请求路径
  - name             # 请求名称 (Locust 报告分组)
  - params           # URL 参数
  - headers          # 请求头
  - catch_response   # 启用响应验证模式 (True/False)

post:
  - url              # 请求路径
  - name             # 请求名称
  - json             # JSON 数据
  - data             # 表单数据
  - headers          # 请求头
  - files            # 上传文件
  - catch_response   # 启用响应验证模式

put:
  - url              # 请求路径
  - name             # 请求名称
  - json             # JSON 数据
  - data             # 表单数据
  - headers          # 请求头
  - catch_response   # 启用响应验证模式

delete:
  - url              # 请求路径
  - name             # 请求名称
  - headers          # 请求头
  - catch_response   # 启用响应验证模式

patch:
  - url              # 请求路径
  - name             # 请求名称
  - json             # JSON 数据
  - headers          # 请求头
  - catch_response   # 启用响应验证模式

# ================================
# 等待时间关键字
# 对应 Locust: wait_time = between()/constant()
# ================================
wait:
  - seconds          # 固定等待秒数 (对应 constant)
  - min              # 最小秒数 (对应 between)
  - max              # 最大秒数 (对应 between)

constant_pacing:
  - seconds          # 固定节奏间隔秒数

# ================================
# 响应验证关键字 (catch_response 模式)
# 对应 Locust: with self.client.get(..., catch_response=True) as response
# ================================
assert_status:
  - expected         # 期望状态码 (默认 200)
  - fail_on_error    # 失败时标记请求失败 (默认 True)

assert_response_time:
  - max_ms           # 最大响应时间 (毫秒)
  - fail_on_error    # 超时标记失败 (默认 True)

assert_contains:
  - text             # 期望包含的文本
  - fail_on_error    # 不包含时标记失败 (默认 True)

assert_json:
  - path             # JSONPath 表达式
  - expected         # 期望值
  - operator         # 比较操作符: eq, ne, gt, lt, gte, lte, contains
  - fail_on_error    # 验证失败标记失败 (默认 True)

assert_header:
  - name             # 响应头名称
  - expected         # 期望值
  - fail_on_error    # 验证失败标记失败 (默认 True)

# 标记响应成功/失败 (用于自定义验证逻辑)
mark_success:
  - message          # 成功消息 (可选)

mark_failure:
  - message          # 失败原因

# ================================
# 事务控制关键字
# 对应 Locust: 自定义事务统计
# ================================
transaction:
  - name             # 事务名称
  - steps            # 事务内的步骤列表

start_transaction:
  - name             # 事务名称

end_transaction:
  - success          # 是否成功 (默认 True)

# ================================
# 顺序任务集关键字
# 对应 Locust: SequentialTaskSet
# ================================
sequential_tasks:
  - name             # 任务集名称
  - steps            # 顺序执行的步骤列表
  - loop             # 循环次数 (默认 1)

# 中断任务集 (对应 self.interrupt())
interrupt:
  - message          # 中断消息 (可选)

# ================================
# 任务权重关键字
# 对应 Locust: @task(weight)
# ================================
task:
  - name             # 任务名称
  - weight           # 任务权重 (默认 1)
  - steps            # 任务步骤列表
  - tags             # 任务标签列表

# ================================
# 数据操作关键字
# ================================
set_var:
  - name             # 变量名
  - value            # 变量值

extract_json:
  - path             # JSONPath 表达式
  - var              # 存储的变量名
  - index            # 结果索引 (默认 0)

extract_regex:
  - pattern          # 正则表达式
  - var              # 存储的变量名
  - group            # 捕获组索引 (默认 1)

extract_header:
  - name             # 响应头名称
  - var              # 存储的变量名

# ================================
# 数据驱动关键字
# 对应 Locust: 类属性数据列表
# ================================
random_data:
  - source           # 数据源: list | file | csv
  - data             # 数据列表 (source=list)
  - file             # 文件路径 (source=file/csv)
  - var              # 存储的变量名

cycle_data:
  - source           # 数据源: list | file | csv
  - data             # 数据列表
  - file             # 文件路径
  - var              # 存储的变量名

# ================================
# 条件控制关键字
# ================================
if_condition:
  - condition        # 条件表达式: {{var}} == value
  - then             # 条件为真时执行的步骤
  - else             # 条件为假时执行的步骤 (可选)

# ================================
# 循环关键字
# ================================
loop:
  - count            # 循环次数
  - steps            # 循环执行的步骤
  - delay            # 每次循环后延迟 (秒)

foreach:
  - items            # 遍历的列表或变量
  - var              # 当前项变量名
  - steps            # 每项执行的步骤

# ================================
# 日志与调试关键字
# ================================
log:
  - message          # 日志消息
  - level            # 日志级别: info, debug, warning, error

print_response:
  - format           # 输出格式: json, text, headers, all

# ================================
# 生命周期钩子关键字
# 对应 Locust: on_start, on_stop
# ================================
on_start:
  - steps            # 用户启动时执行的步骤

on_stop:
  - steps            # 用户停止时执行的步骤

# ================================
# Python 脚本执行关键字
# ================================
run_script:
  - script_path      # 脚本文件路径
  - function_name    # 要调用的函数名 (可选)
  - variable_name    # 保存返回值到变量 (可选)
  # 其他参数将作为函数参数传递

run_code:
  - code             # Python 代码字符串
  - variable_name    # 保存返回值到变量 (可选)

# ================================
# 事件钩子关键字
# 对应 Locust: @events.xxx.add_listener
# ================================
on_request:
  - condition        # 触发条件: slow | error | all
  - threshold_ms     # 慢请求阈值 (毫秒)
  - action           # 动作: log | custom
  - message          # 日志消息模板

on_test_start:
  - steps            # 测试开始时执行的步骤

on_test_stop:
  - steps            # 测试结束时执行的步骤
