"""
ç›‘ç£è€…æ™ºèƒ½ä»£ç†ç¤ºä¾‹
è¿™ä¸ªæ–‡ä»¶å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªç›‘ç£è€…ä»£ç†ï¼Œå®ƒå¯ä»¥åè°ƒå¤šä¸ªå­ä»£ç†ï¼ˆæ—¥å†ä»£ç†å’Œé‚®ä»¶ä»£ç†ï¼‰æ¥å®Œæˆå¤æ‚ä»»åŠ¡
"""
import os
import sys
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
from utils import init_chat_model  # ä½¿ç”¨è‡ªå®šä¹‰çš„init_chat_modelï¼ˆæ”¯æŒç¡…åŸºæµåŠ¨ï¼‰
from langchain_core.tools import tool  # å¯¼å…¥å·¥å…·è£…é¥°å™¨ï¼Œç”¨äºåˆ›å»ºä»£ç†å¯ä»¥ä½¿ç”¨çš„å·¥å…·
from langchain.agents import create_agent  # å¯¼å…¥åˆ›å»ºä»£ç†çš„å‡½æ•°
from langchain.agents.middleware import HumanInTheLoopMiddleware  # å¯¼å…¥äººæœºäº¤äº’ä¸­é—´ä»¶
from langgraph.checkpoint.memory import InMemorySaver  # å¯¼å…¥å†…å­˜æ£€æŸ¥ç‚¹ä¿å­˜å™¨
from langgraph.types import Command  # å¯¼å…¥å‘½ä»¤ç±»å‹ï¼Œç”¨äºæ¢å¤ä¸­æ–­çš„æ‰§è¡Œ

# è®¾ç½® DeepSeek API å¯†é’¥ï¼ˆè¿™æ˜¯ä¸€ä¸ªå¤§è¯­è¨€æ¨¡å‹æœåŠ¡ï¼‰
os.environ["SILICONFLOW_API_KEY"] = "sk-rmcrubplntqwdjumperktjbnepklekynmnmianaxtkneocem"
# åˆå§‹åŒ– DeepSeek èŠå¤©æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹å°†è¢«æ‰€æœ‰ä»£ç†ä½¿ç”¨
model = init_chat_model("siliconflow:deepseek-ai/DeepSeek-V3.2-Exp")


# ============ åŸºç¡€å·¥å…·å‡½æ•° ============
# è¿™äº›æ˜¯æ—¥å†ä»£ç†å’Œé‚®ä»¶ä»£ç†ä¼šä½¿ç”¨çš„åº•å±‚å·¥å…·

@tool
def create_calendar_event(
    title: str,            # æ—¥å†äº‹ä»¶æ ‡é¢˜
    start_time: str,       # å¼€å§‹æ—¶é—´ï¼ŒISOæ ¼å¼: "2024-01-15T14:00:00"
    end_time: str,         # ç»“æŸæ—¶é—´ï¼ŒISOæ ¼å¼: "2024-01-15T15:00:00"
    attendees: list[str],  # å‚ä¼šè€…çš„é‚®ç®±åœ°å€åˆ—è¡¨
    location: str = ""     # ä¼šè®®åœ°ç‚¹ï¼ˆå¯é€‰ï¼‰
) -> str:
    """åˆ›å»ºæ—¥å†äº‹ä»¶ã€‚éœ€è¦ç²¾ç¡®çš„ISOæ—¥æœŸæ—¶é—´æ ¼å¼ã€‚
    
    è¿™ä¸ªå‡½æ•°ç”¨äºåœ¨æ—¥å†ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶/ä¼šè®®ã€‚
    åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™ä¼šè°ƒç”¨çœŸå®çš„æ—¥å†APIï¼ˆå¦‚Googleæ—¥å†ã€Outlookç­‰ï¼‰ã€‚
    """
    # æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿå®ç°ï¼Œå®é™…åº”ç”¨ä¸­éœ€è¦è°ƒç”¨çœŸå®çš„æ—¥å†API
    return f"äº‹ä»¶å·²åˆ›å»º: {title}ï¼Œæ—¶é—´ä» {start_time} åˆ° {end_time}ï¼Œå…± {len(attendees)} ä½å‚ä¼šè€…"


@tool
def send_email(
    to: list[str],      # æ”¶ä»¶äººé‚®ç®±åœ°å€åˆ—è¡¨
    subject: str,       # é‚®ä»¶ä¸»é¢˜
    body: str,          # é‚®ä»¶æ­£æ–‡å†…å®¹
    cc: list[str] = []  # æŠ„é€äººé‚®ç®±åœ°å€åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
) -> str:
    """é€šè¿‡é‚®ä»¶APIå‘é€é‚®ä»¶ã€‚éœ€è¦æ­£ç¡®æ ¼å¼çš„é‚®ç®±åœ°å€ã€‚
    
    è¿™ä¸ªå‡½æ•°ç”¨äºå‘é€ç”µå­é‚®ä»¶ã€‚
    åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™ä¼šè°ƒç”¨çœŸå®çš„é‚®ä»¶æœåŠ¡APIï¼ˆå¦‚SendGridã€Gmail APIç­‰ï¼‰ã€‚
    """
    # æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿå®ç°ï¼Œå®é™…åº”ç”¨ä¸­éœ€è¦è°ƒç”¨çœŸå®çš„é‚®ä»¶API
    return f"é‚®ä»¶å·²å‘é€ç»™ {', '.join(to)} - ä¸»é¢˜: {subject}"


@tool
def get_available_time_slots(
    attendees: list[str],    # å‚ä¼šè€…é‚®ç®±åœ°å€åˆ—è¡¨
    date: str,               # æ—¥æœŸï¼ŒISOæ ¼å¼: "2024-01-15"
    duration_minutes: int    # ä¼šè®®æŒç»­æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
) -> list[str]:
    """æ£€æŸ¥æŒ‡å®šæ—¥æœŸå‚ä¼šè€…çš„æ—¥å†ç©ºé—²æ—¶é—´æ®µã€‚
    
    è¿™ä¸ªå‡½æ•°ç”¨äºæŸ¥è¯¢æ‰€æœ‰å‚ä¼šè€…åœ¨æŸä¸€å¤©çš„å…±åŒç©ºé—²æ—¶é—´ã€‚
    åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™ä¼šæŸ¥è¯¢æ—¥å†APIè·å–çœŸå®çš„ç©ºé—²æ—¶é—´ã€‚
    """
    # æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿå®ç°ï¼Œè¿”å›å›ºå®šçš„æ—¶é—´æ®µ
    # å®é™…åº”ç”¨ä¸­éœ€è¦æŸ¥è¯¢çœŸå®çš„æ—¥å†API
    return ["09:00", "14:00", "16:00"]




# ============ æ—¥å†ä»£ç† ============
# è¿™ä¸ªä»£ç†ä¸“é—¨è´Ÿè´£å¤„ç†æ—¥å†ç›¸å…³çš„ä»»åŠ¡

CALENDAR_AGENT_PROMPT = (
    "ä½ æ˜¯ä¸€ä¸ªæ—¥å†è°ƒåº¦åŠ©æ‰‹ã€‚"
    "å°†è‡ªç„¶è¯­è¨€çš„æ—¥ç¨‹è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼š'ä¸‹å‘¨äºŒä¸‹åˆ2ç‚¹'ï¼‰"
    "è§£ææˆæ­£ç¡®çš„ISOæ—¥æœŸæ—¶é—´æ ¼å¼ã€‚"
    "åœ¨éœ€è¦æ—¶ä½¿ç”¨ get_available_time_slots æ£€æŸ¥ç©ºé—²æ—¶é—´ã€‚"
    "ä½¿ç”¨ create_calendar_event åˆ›å»ºæ—¥ç¨‹äº‹ä»¶ã€‚"
    "åœ¨æœ€ç»ˆå›å¤ä¸­å§‹ç»ˆç¡®è®¤å·²å®‰æ’çš„å†…å®¹ã€‚"
)

# åˆ›å»ºæ—¥å†ä»£ç†ï¼Œé…å¤‡æ—¥å†ç›¸å…³çš„å·¥å…·å’Œäººæœºäº¤äº’ä¸­é—´ä»¶
calendar_agent = create_agent(
    model,                                                    # ä½¿ç”¨çš„è¯­è¨€æ¨¡å‹
    tools=[create_calendar_event, get_available_time_slots],  # æ—¥å†ä»£ç†å¯ä»¥ä½¿ç”¨çš„å·¥å…·
    system_prompt=CALENDAR_AGENT_PROMPT,                     # ä»£ç†çš„ç³»ç»Ÿæç¤ºè¯
    middleware=[
        HumanInTheLoopMiddleware(
            interrupt_on={"create_calendar_event": True},     # åœ¨åˆ›å»ºæ—¥å†äº‹ä»¶æ—¶ä¸­æ–­ï¼Œç­‰å¾…äººå·¥å®¡æ ¸
            description_prefix="æ—¥å†äº‹ä»¶å¾…å®¡æ‰¹",              # ä¸­æ–­æ—¶æ˜¾ç¤ºçš„æè¿°å‰ç¼€
        ),
    ],
)



# ============ é‚®ä»¶ä»£ç† ============
# è¿™ä¸ªä»£ç†ä¸“é—¨è´Ÿè´£å¤„ç†é‚®ä»¶ç›¸å…³çš„ä»»åŠ¡

EMAIL_AGENT_PROMPT = (
    "ä½ æ˜¯ä¸€ä¸ªé‚®ä»¶åŠ©æ‰‹ã€‚"
    "æ ¹æ®è‡ªç„¶è¯­è¨€è¯·æ±‚æ’°å†™ä¸“ä¸šçš„ç”µå­é‚®ä»¶ã€‚"
    "æå–æ”¶ä»¶äººä¿¡æ¯ï¼Œå¹¶æ’°å†™åˆé€‚çš„ä¸»é¢˜å’Œæ­£æ–‡å†…å®¹ã€‚"
    "ä½¿ç”¨ send_email å‘é€é‚®ä»¶ã€‚"
    "åœ¨æœ€ç»ˆå›å¤ä¸­å§‹ç»ˆç¡®è®¤å·²å‘é€çš„å†…å®¹ã€‚"
)

# åˆ›å»ºé‚®ä»¶ä»£ç†ï¼Œé…å¤‡é‚®ä»¶ç›¸å…³çš„å·¥å…·å’Œäººæœºäº¤äº’ä¸­é—´ä»¶
email_agent = create_agent(
    model,                        # ä½¿ç”¨çš„è¯­è¨€æ¨¡å‹
    tools=[send_email],           # é‚®ä»¶ä»£ç†å¯ä»¥ä½¿ç”¨çš„å·¥å…·
    system_prompt=EMAIL_AGENT_PROMPT,  # ä»£ç†çš„ç³»ç»Ÿæç¤ºè¯
    middleware=[
        HumanInTheLoopMiddleware(
            interrupt_on={"send_email": True},  # åœ¨å‘é€é‚®ä»¶æ—¶ä¸­æ–­ï¼Œç­‰å¾…äººå·¥å®¡æ ¸
            description_prefix="å¾…å‘é€é‚®ä»¶å®¡æ‰¹",  # ä¸­æ–­æ—¶æ˜¾ç¤ºçš„æè¿°å‰ç¼€
        ),
    ],
)


# ============ ç›‘ç£è€…ä»£ç†çš„é«˜çº§å·¥å…· ============
# è¿™äº›å·¥å…·å°†å­ä»£ç†å°è£…æˆç›‘ç£è€…å¯ä»¥è°ƒç”¨çš„å·¥å…·

@tool
def schedule_event(request: str) -> str:
    """ä½¿ç”¨è‡ªç„¶è¯­è¨€å®‰æ’æ—¥å†äº‹ä»¶ã€‚
    
    å½“ç”¨æˆ·æƒ³è¦åˆ›å»ºã€ä¿®æ”¹æˆ–æ£€æŸ¥æ—¥å†é¢„çº¦æ—¶ä½¿ç”¨æ­¤å·¥å…·ã€‚
    å¤„ç†æ—¥æœŸ/æ—¶é—´è§£æã€ç©ºé—²æ—¶é—´æ£€æŸ¥å’Œäº‹ä»¶åˆ›å»ºã€‚

    è¾“å…¥ï¼šè‡ªç„¶è¯­è¨€çš„æ—¥ç¨‹è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼š'ä¸‹å‘¨äºŒä¸‹åˆ2ç‚¹ä¸è®¾è®¡å›¢é˜Ÿå¼€ä¼š'ï¼‰
    """
    # è°ƒç”¨æ—¥å†ä»£ç†æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚
    result = calendar_agent.invoke({
        "messages": [{"role": "user", "content": request}]
    })
    # è¿”å›æ—¥å†ä»£ç†çš„æœ€åä¸€æ¡æ¶ˆæ¯ï¼ˆå¤„ç†ç»“æœï¼‰
    return result["messages"][-1].text


@tool
def manage_email(request: str) -> str:
    """ä½¿ç”¨è‡ªç„¶è¯­è¨€å‘é€é‚®ä»¶ã€‚

    å½“ç”¨æˆ·æƒ³è¦å‘é€é€šçŸ¥ã€æé†’æˆ–ä»»ä½•é‚®ä»¶æ²Ÿé€šæ—¶ä½¿ç”¨æ­¤å·¥å…·ã€‚
    å¤„ç†æ”¶ä»¶äººæå–ã€ä¸»é¢˜ç”Ÿæˆå’Œé‚®ä»¶å†…å®¹ç¼–å†™ã€‚

    è¾“å…¥ï¼šè‡ªç„¶è¯­è¨€çš„é‚®ä»¶è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼š'ç»™ä»–ä»¬å‘é€ä¸€ä¸ªå…³äºä¼šè®®çš„æé†’'ï¼‰
    """
    # è°ƒç”¨é‚®ä»¶ä»£ç†æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚
    result = email_agent.invoke({
        "messages": [{"role": "user", "content": request}]
    })
    # è¿”å›é‚®ä»¶ä»£ç†çš„æœ€åä¸€æ¡æ¶ˆæ¯ï¼ˆå¤„ç†ç»“æœï¼‰
    return result["messages"][-1].text


# ============ ç›‘ç£è€…ä»£ç† ============
# è¿™æ˜¯æœ€é«˜å±‚çš„ä»£ç†ï¼Œå®ƒåè°ƒå…¶ä»–ä»£ç†æ¥å®Œæˆå¤æ‚ä»»åŠ¡

SUPERVISOR_PROMPT = (
    "ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„ä¸ªäººåŠ©ç†ã€‚"
    "ä½ å¯ä»¥å®‰æ’æ—¥å†äº‹ä»¶å’Œå‘é€é‚®ä»¶ã€‚"
    "å°†ç”¨æˆ·è¯·æ±‚åˆ†è§£ä¸ºé€‚å½“çš„å·¥å…·è°ƒç”¨ï¼Œå¹¶åè°ƒç»“æœã€‚"
    "å½“è¯·æ±‚æ¶‰åŠå¤šä¸ªæ“ä½œæ—¶ï¼ŒæŒ‰é¡ºåºä½¿ç”¨å¤šä¸ªå·¥å…·ã€‚"
)

# åˆ›å»ºç›‘ç£è€…ä»£ç†ï¼Œå®ƒå¯ä»¥è°ƒç”¨æ—¥å†å’Œé‚®ä»¶ä»£ç†
# æ³¨æ„ï¼šåªæœ‰ç›‘ç£è€…éœ€è¦ checkpointerï¼Œè¿™æ ·æ‰èƒ½æš‚åœå’Œæ¢å¤æ‰§è¡Œ
supervisor_agent = create_agent(
    model,                              # ä½¿ç”¨çš„è¯­è¨€æ¨¡å‹
    tools=[schedule_event, manage_email],  # ç›‘ç£è€…å¯ä»¥ä½¿ç”¨çš„é«˜çº§å·¥å…·
    system_prompt=SUPERVISOR_PROMPT,    # ç›‘ç£è€…çš„ç³»ç»Ÿæç¤ºè¯
    checkpointer=InMemorySaver(),       # æ·»åŠ æ£€æŸ¥ç‚¹ä¿å­˜å™¨ï¼Œç”¨äºä¿å­˜æ‰§è¡ŒçŠ¶æ€
)


# ============ ä¸»ç¨‹åº ============
# è¿™é‡Œæ˜¯ä»£ç çš„å…¥å£ç‚¹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨å¸¦äººæœºäº¤äº’è¯„å®¡çš„ç›‘ç£è€…ä»£ç†

if __name__ == "__main__":
    # å®šä¹‰ä¸€ä¸ªå¤æ‚çš„ç”¨æˆ·è¯·æ±‚ï¼ŒåŒ…å«æ—¥å†å’Œé‚®ä»¶ä¸¤ä¸ªä»»åŠ¡
    query = (
        "å®‰æ’ä¸‹å‘¨äºŒä¸‹åˆ2ç‚¹ä¸è®¾è®¡å›¢é˜Ÿï¼ˆdesign@example.comï¼‰å¼€ä¼š1å°æ—¶ï¼Œ"
        "å¹¶ç»™ä»–ä»¬å‘é€ä¸€å°é‚®ä»¶æé†’å…³äºå®¡æŸ¥æ–°çš„è®¾è®¡ç¨¿ã€‚"
    )

    # é…ç½®çº¿ç¨‹IDï¼Œç”¨äºè·Ÿè¸ªä¼šè¯çŠ¶æ€
    config = {"configurable": {"thread_id": "demo_session_1"}}
    
    # ç”¨äºå­˜å‚¨æ‰€æœ‰ä¸­æ–­ç‚¹çš„åˆ—è¡¨
    interrupts = []
    
    print("=" * 60)
    print("ç¬¬ä¸€é˜¶æ®µï¼šæ‰§è¡Œä»£ç†ä»»åŠ¡ï¼Œæ”¶é›†éœ€è¦å®¡æ‰¹çš„æ“ä½œ")
    print("=" * 60)
    
    # ä½¿ç”¨æµå¼å¤„ç†æ¥æ‰§è¡Œä»£ç†ï¼Œè¿™æ ·å¯ä»¥å®æ—¶çœ‹åˆ°æ¯ä¸€æ­¥çš„è¾“å‡º
    for step in supervisor_agent.stream(
        {"messages": [{"role": "user", "content": query}]},
        config,  # ä¼ å…¥é…ç½®ï¼Œå¯ç”¨æ£€æŸ¥ç‚¹åŠŸèƒ½
    ):
        # éå†æ¯ä¸€æ­¥çš„æ›´æ–°
        for update in step.values():
            # æ£€æŸ¥æ›´æ–°æ˜¯å¦æ˜¯å­—å…¸ç±»å‹ï¼ˆæ­£å¸¸æ¶ˆæ¯ï¼‰
            if isinstance(update, dict):
                # éå†æ¯ä¸ªæ›´æ–°ä¸­çš„æ¶ˆæ¯
                for message in update.get("messages", []):
                    # æ¼‚äº®åœ°æ‰“å°æ¶ˆæ¯ï¼ˆå¸¦æœ‰æ ¼å¼åŒ–ï¼‰
                    message.pretty_print()
            else:
                # å¦‚æœä¸æ˜¯å­—å…¸ï¼Œè¯´æ˜é‡åˆ°äº†ä¸­æ–­ç‚¹ï¼ˆéœ€è¦äººå·¥å®¡æ‰¹ï¼‰
                interrupt_ = update[0]
                interrupts.append(interrupt_)
                print(f"\nâš ï¸  ä¸­æ–­: {interrupt_.id}")
    
    print("\n" + "=" * 60)
    print("ç¬¬äºŒé˜¶æ®µï¼šæ˜¾ç¤ºæ‰€æœ‰å¾…å®¡æ‰¹çš„æ“ä½œè¯¦æƒ…")
    print("=" * 60)
    
    # æ˜¾ç¤ºæ‰€æœ‰ä¸­æ–­ç‚¹çš„è¯¦ç»†ä¿¡æ¯
    for interrupt_ in interrupts:
        for request in interrupt_.value["action_requests"]:
            print(f"\nğŸ“‹ ä¸­æ–­ID: {interrupt_.id}")
            print(f"ğŸ“ æè¿°: {request.get('description', 'æ— æè¿°')}")
            print(f"ğŸ”§ å·¥å…·: {request.get('name', 'æœªçŸ¥')}")
            print(f"ğŸ“Š å‚æ•°: {request.get('args', {})}")
            print("-" * 60)
    
    print("\n" + "=" * 60)
    print("ç¬¬ä¸‰é˜¶æ®µï¼šäººå·¥å®¡æ‰¹å†³ç­–")
    print("=" * 60)
    
    # æ„å»ºå®¡æ‰¹å†³ç­–
    # è¿™é‡Œæ¼”ç¤ºä¸‰ç§å†³ç­–ç±»å‹ï¼šæ‰¹å‡†(approve)ã€ç¼–è¾‘(edit)ã€æ‹’ç»(reject)
    resume = {}
    
    for interrupt_ in interrupts:
        # è·å–ä¸­æ–­çš„æ“ä½œè¯·æ±‚
        action_request = interrupt_.value["action_requests"][0]
        
        # æ ¹æ®ä¸åŒçš„å·¥å…·åšä¸åŒçš„å†³ç­–ï¼ˆè¿™é‡Œæ˜¯ç¤ºä¾‹é€»è¾‘ï¼‰
        if action_request.get("name") == "send_email":
            # å¯¹äºé‚®ä»¶ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸»é¢˜ä½¿å…¶æ›´ç®€æ´
            print(f"\nâœï¸  ç¼–è¾‘é‚®ä»¶ä¸»é¢˜...")
            edited_action = action_request.copy()
            edited_action["args"]["subject"] = "è®¾è®¡ç¨¿å®¡æŸ¥æé†’"
            resume[interrupt_.id] = {
                "decisions": [{"type": "edit", "edited_action": edited_action}]
            }
            print(f"   åŸä¸»é¢˜: {action_request.get('args', {}).get('subject', 'æ— ')}")
            print(f"   æ–°ä¸»é¢˜: {edited_action['args']['subject']}")
        else:
            # å¯¹äºå…¶ä»–æ“ä½œï¼ˆå¦‚åˆ›å»ºæ—¥å†äº‹ä»¶ï¼‰ï¼Œç›´æ¥æ‰¹å‡†
            print(f"\nâœ… æ‰¹å‡†æ“ä½œ: {action_request.get('name', 'æœªçŸ¥å·¥å…·')}")
            resume[interrupt_.id] = {
                "decisions": [{"type": "approve"}]
            }
    
    print("\n" + "=" * 60)
    print("ç¬¬å››é˜¶æ®µï¼šåº”ç”¨å®¡æ‰¹å†³ç­–ï¼Œç»§ç»­æ‰§è¡Œ")
    print("=" * 60)
    
    # æ¸…ç©ºä¸­æ–­åˆ—è¡¨ï¼Œå‡†å¤‡æ¥æ”¶æ–°çš„ä¸­æ–­ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
    interrupts = []
    
    # ä½¿ç”¨ Command å¯¹è±¡æ¢å¤æ‰§è¡Œï¼Œä¼ å…¥å®¡æ‰¹å†³ç­–
    for step in supervisor_agent.stream(
        Command(resume=resume),  # ä¼ å…¥å®¡æ‰¹å†³ç­–
        config,  # ä½¿ç”¨ç›¸åŒçš„é…ç½®ç»§ç»­ä¼šè¯
    ):
        # éå†æ¯ä¸€æ­¥çš„æ›´æ–°
        for update in step.values():
            if isinstance(update, dict):
                # æ­£å¸¸æ¶ˆæ¯ï¼Œæ‰“å°è¾“å‡º
                for message in update.get("messages", []):
                    message.pretty_print()
            else:
                # å¦‚æœè¿˜æœ‰æ–°çš„ä¸­æ–­ç‚¹
                interrupt_ = update[0]
                interrupts.append(interrupt_)
                print(f"\nâš ï¸  æ–°çš„ä¸­æ–­: {interrupt_.id}")
    
    print("\n" + "=" * 60)
    print("âœ¨ ä»»åŠ¡å®Œæˆï¼")
    print("=" * 60)