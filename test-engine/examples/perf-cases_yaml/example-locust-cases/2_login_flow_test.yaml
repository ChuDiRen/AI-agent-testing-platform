# 登录流程性能测试
# 演示: 事务控制、数据提取、生命周期钩子

name: 登录流程性能测试
desc: 测试完整的登录流程性能

# 用户启动时执行 (登录)
on_start:
  - 用户登录:
      关键字: post
      url: /api/login
      name: 登录
      json:
        username: "{{username}}"
        password: "{{password}}"

  - 提取Token:
      关键字: extract_json
      path: $.token
      var: auth_token

# 用户停止时执行 (登出)
on_stop:
  - 用户登出:
      关键字: post
      url: /api/logout
      name: 登出
      headers:
        Authorization: "Bearer {{auth_token}}"

steps:
  # 开始事务
  - 开始查询事务:
      关键字: start_transaction
      name: 用户信息查询

  # 查询用户信息
  - 查询用户信息:
      关键字: get
      url: /api/user/profile
      name: 获取用户信息
      headers:
        Authorization: "Bearer {{auth_token}}"

  # 验证状态码
  - 验证状态码:
      关键字: assert_status
      expected: 200

  # 结束事务
  - 结束查询事务:
      关键字: end_transaction
      success: true

  # 用户思考
  - 用户思考:
      关键字: wait
      min: 1
      max: 2

  # 查询订单列表
  - 查询订单列表:
      关键字: get
      url: /api/orders
      name: 获取订单列表
      headers:
        Authorization: "Bearer {{auth_token}}"
