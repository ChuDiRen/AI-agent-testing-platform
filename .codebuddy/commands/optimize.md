---
name: optimize
description: 流程优化命令。检查并优化 .codebuddy 配置，修正冲突、同步文档、记录优化日志。
---

# 流程优化命令

## 使用方式

```
/optimize [选项]
```

## 选项

| 选项 | 说明 |
|-----|------|
| （无） | 完整优化：检查 + 自动修正 + 生成日志 |
| `--check-only` | 仅检查，不修正 |
| `--force` | 强制优化（忽略频率控制） |

## 执行流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           流程优化流程                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  /optimize → 触发 self-optimize 规则                                        │
│       │                                                                     │
│       ├── 1. 路径一致性检查                                                  │
│       │       ├── doc/ → docs/ 替换                                        │
│       │       └── 过时文件引用修正                                           │
│       │                                                                     │
│       ├── 2. 规则冲突检查                                                    │
│       │       ├── 矛盾行为指令                                               │
│       │       └── 确认点策略一致性                                           │
│       │                                                                     │
│       ├── 3. 入口文档同步                                                    │
│       │       └── README.md Commands/Agents/Rules 清单                      │
│       │                                                                     │
│       ├── 4. 流程完整性检查                                                  │
│       │       ├── Command → 执行逻辑                                        │
│       │       └── Agent → Skill 引用                                        │
│       │                                                                     │
│       └── 5. 生成优化日志                                                    │
│               └── .codebuddy/logs/optimize-{timestamp}.md                   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 检查项

### 自动修正（无需确认）

- 路径错误：`doc/` → `docs/`
- 过时文件引用
- README 清单同步
- 缺失目录创建

### 需用户确认

- 删除 Agent/Skill/Command
- 新增 Rule/Command
- 修改确认点策略
- 重构 Skill 核心逻辑

## 示例

### 完整优化

```
/optimize
```

输出：
```
🔍 开始流程优化...

【路径一致性检查】
✅ 所有路径已统一为 docs/

【规则冲突检查】
✅ 无冲突

【入口文档同步】
⚠️ README.md 中 Commands 清单过期
✅ 已自动同步

【流程完整性检查】
✅ 所有引用有效

📝 优化日志已保存：.codebuddy/logs/optimize-20260115-143052.md

✅ 流程优化完成！
```

### 仅检查

```
/optimize --check-only
```

输出：
```
🔍 流程检查结果...

【发现问题】
1. README.md 中 Commands 清单过期
2. skill-creator 引用的模板文件不存在

【建议修正】
运行 `/optimize` 自动修正上述问题
```

## 优化日志位置

- 目录：`.codebuddy/logs/`
- 命名：`optimize-{YYYYMMDD-HHmmss}.md`
- 示例：`optimize-20260115-143052.md`

## 频率控制

- 自动优化：同一会话最多 1 次，间隔 ≥ 10 分钟
- 手动 `/optimize`：无限制
- `--force` 选项：忽略频率控制
