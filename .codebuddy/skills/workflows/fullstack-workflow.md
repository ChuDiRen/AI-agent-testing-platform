# 前后端分离项目开发工作流

## 概述
本 Skill 提供技术栈无关的前后端分离项目开发工作流指导，适用于任何前后端技术组合。

## 工作流总览

```
阶段1 → 阶段2 → 阶段3 → 阶段4 → 阶段5 → 阶段6/7(并行) → 阶段8 → 阶段9
初始化   需求    原型    任务拆分  API设计   前后端开发      联调     测试部署
```

---

## 阶段1：项目初始化与模式选择

### 开发模式选择
根据项目规模选择合适的开发模式：

**模式一：统一文件夹管理**（适合小型项目）
```
project-name/
├── frontend/     # 前端项目
├── backend/      # 后端项目
└── doc/          # 共享文档
    ├── PRD.md
    ├── frontend-tasks.md
    └── backend-tasks.md
```
- 优点：一次对话能同时修改前端和后端
- 缺点：项目规模大时不好管理，容易挤爆上下文

**模式二：分离文件夹管理**（推荐大中型项目）
- 前端项目独立管理
- 后端项目独立管理
- 使用不同的编辑器窗口打开

### 输出物
- [ ] 项目目录结构
- [ ] 基础配置文件

### 进入下一阶段条件
- 项目初始化完成，可正常运行

---

## 阶段2：需求分析与文档

### 产品需求文档生成
```prompt
我现在需要做一个[项目类型]，产品的功能包括：
1. [功能1]
2. [功能2]
3. [功能3]

根据以上内容，帮我完成一个产品需求文档，需要包含：
- 页面设计
- UI元素
- 技术栈建议
- 不要包含任何代码
```

### 输出物
- [ ] 产品需求文档 (`doc/PRD.md`)
- [ ] 功能清单

### 进入下一阶段条件
- 需求文档已确认，无歧义

---

## 阶段3：原型设计

使用 `prototype-design` skill 生成高保真原型界面。

### 输入
- 阶段2 的产品需求文档

### 输出物
- [ ] 原型页面 HTML 文件 (`prototype/`)
- [ ] 页面交互说明

### 进入下一阶段条件
- 原型已与产品/客户确认

---

## 阶段4：任务拆分

使用 `task-splitting` skill 将需求拆分为可执行的开发任务。

### 输入
- 阶段2 的需求文档
- 阶段3 的原型设计

### 任务拆分示例
```markdown
## TASK-FE-001 - 项目初始化
**状态：** ✅ 已完成
**预估工时：** 4 小时
**依赖任务：** 无

### 具体工作
1. 创建前端项目
2. 配置 UI 组件库、状态管理、路由
3. 封装 HTTP 请求工具
4. 配置 Mock 数据支持

### 验收标准
- [x] 项目可正常启动
- [x] 基础配置完成
```

### 任务状态标记
- `计划中` - 待开发
- `进行中` - 开发中
- `✅ 已完成` - 开发完成

### 输出物
- [ ] 前端任务清单 (`doc/frontend-tasks.md`)
- [ ] 后端任务清单 (`doc/backend-tasks.md`)

### 进入下一阶段条件
- 任务清单已评审，工作量已评估

---

## 阶段5：API 接口设计（关键阶段）

> **重要**：此阶段必须在前后端开发之前完成，确保前后端接口规范一致。

### 统一响应格式
```typescript
interface ApiResponse<T> {
  code: number      // 200 成功，其他失败
  message: string   // 提示信息
  data: T           // 业务数据
}

interface PageResult<T> {
  list: T[]         // 数据列表
  total: number     // 总条数
  page: number      // 当前页
  pageSize: number  // 每页条数
}
```

### Mock 数据设计原则
1. **使用扁平结构存储**：便于 CRUD 操作
2. **提供树形转换函数**：用于菜单、部门等树形数据
3. **支持筛选和分页**：模拟真实接口行为

### 输出物
- [ ] API 接口文档 (`doc/api/*.md`)
- [ ] Mock 数据模板
- [ ] 统一响应格式定义

---

## 阶段6：前端开发

### 页面开发标准流程

每个 CRUD 页面按以下步骤开发：

#### Step 1: 创建 API 模块
- 定义接口类型
- 封装 HTTP 请求方法

#### Step 2: 添加 Mock 接口
- 创建模拟数据
- 实现筛选、分页逻辑

#### Step 3: 创建页面组件
- 搜索表单
- 操作按钮
- 数据表格
- 分页组件
- 弹窗表单

#### Step 4: 更新任务文档
将任务状态从 `计划中` 改为 `✅ 已完成`

### 权限控制要点

#### 路由权限
- 在路由 meta 中定义权限标识
- 根据用户权限动态生成路由

#### 按钮权限
- 使用权限指令或方法控制按钮显示
- 权限数据从后端获取

#### 状态持久化（重要！）
- 从本地存储恢复权限，避免刷新后丢失

### 常见问题处理

| 问题 | 解决方案 |
|------|---------|
| 刷新后菜单消失 | 从本地存储恢复权限数据 |
| API 导出错误 | 检查导出方式（具名导出 vs 默认导出） |
| 树形表格不显示 | 检查唯一键和树形配置 |
| 表单验证不生效 | 检查字段名与规则名一致 |

---

## 阶段7：后端开发（可与阶段6并行）

### 关键规范
- 数据库设计优先
- 遵循分层架构（Controller/Router → Service → Repository/DAO）
- 接口实现必须与阶段5的接口文档保持一致

### 分层架构

```
┌─────────────────────────────────────────┐
│  Controller / Router 层                  │
│  职责：请求处理、参数校验、响应封装        │
├─────────────────────────────────────────┤
│  Service 层                              │
│  职责：业务逻辑、事务管理、权限控制        │
├─────────────────────────────────────────┤
│  Repository / DAO 层                     │
│  职责：数据访问、缓存操作                 │
├─────────────────────────────────────────┤
│  Model / Entity 层                       │
│  职责：数据模型定义                       │
└─────────────────────────────────────────┘
```

---

## 阶段8：前后端联调

### 联调步骤
```markdown
1. 配置后端地址
   - 修改环境配置文件
   - 设置 API 基础 URL

2. 关闭 Mock 模式
   - 禁用 Mock 插件或配置

3. 逐个接口测试
   - 检查请求/响应格式
   - 检查字段名称一致性

4. 问题修复
   - 前端适配接口变更
   - 同步更新文档
```

### 联调检查清单
```markdown
- [ ] 登录认证正常
- [ ] Token 传递正确
- [ ] 分页格式一致
- [ ] 树形数据结构一致
- [ ] 错误处理正常
```

---

## 阶段9：测试与部署

### 测试策略
| 测试类型 | 工具 |
|---------|------|
| 接口测试 | `api-testing` skill |
| E2E 测试 | `webapp-testing` skill |

---

## 核心原则

1. **任务越小越细，代码质量越高**
2. **先定接口，再并行开发**
3. **Mock 数据结构必须与真实接口一致**
4. **每完成一个任务立即更新文档状态**
5. **权限状态必须持久化到本地存储**

---

## 快速参考

### 文档目录结构
```
doc/
├── PRD.md                 # 产品需求文档
├── frontend-tasks.md      # 前端任务清单
├── backend-tasks.md       # 后端任务清单
└── api/                   # API 接口文档
```

### 通用前端目录结构
```
src/
├── api/
│   ├── modules/           # API 模块
│   └── mock/              # Mock 数据
├── stores/                # 状态管理
├── views/                 # 页面组件
└── layout/                # 布局组件
```

### 通用后端目录结构
```
app/
├── api/                   # API 路由
├── services/              # 业务逻辑
├── repositories/          # 数据访问
├── models/                # 数据模型
├── schemas/               # 请求/响应模型
└── utils/                 # 工具函数
```
