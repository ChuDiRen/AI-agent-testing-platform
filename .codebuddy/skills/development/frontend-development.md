# 前端开发通用规范 Skill

## 概述
本 Skill 提供技术栈无关的前端开发规范和最佳实践，适用于任何前端框架（Vue、React、Angular 等）。

## 项目结构规范

### 推荐目录结构
```
src/
├── api/                  # API 接口
│   ├── modules/          # 按模块拆分的 API
│   └── mock/             # Mock 数据
├── assets/               # 静态资源
├── components/           # 公共组件
├── composables/          # 组合式函数 / Hooks
├── layout/               # 布局组件
├── router/               # 路由配置
├── stores/               # 状态管理
├── styles/               # 全局样式
├── utils/                # 工具函数
└── views/                # 页面组件
```

---

## 页面开发流程（CRUD 页面标准流程）

### 1. 创建 API 模块
```
职责：
- 定义接口类型
- 封装 HTTP 请求方法
- 统一错误处理
```

### 2. 添加 Mock 数据
```
职责：
- 创建模拟数据
- 实现筛选逻辑
- 实现分页逻辑
- 模拟延迟响应
```

### 3. 创建页面组件
```
标准页面结构：
┌─────────────────────────────────────┐
│           搜索表单区域              │
├─────────────────────────────────────┤
│           操作按钮区域              │
├─────────────────────────────────────┤
│           数据表格区域              │
├─────────────────────────────────────┤
│           分页组件区域              │
└─────────────────────────────────────┘
```

### 4. 更新任务文档
- 将任务状态从 `计划中` 改为 `✅ 已完成`
- 更新验收标准清单

---

## 权限控制

### 路由权限
```
实现要点：
1. 在路由配置中定义权限标识
2. 根据用户权限动态生成可访问路由
3. 未授权路由重定向到 403 页面
```

### 按钮权限
```
实现要点：
1. 创建权限检查方法/指令
2. 根据权限控制按钮显示/隐藏
3. 权限数据从后端获取
```

### 状态持久化（重要！）
```
实现要点：
1. 登录成功后保存用户信息到本地存储
2. 页面刷新时从本地存储恢复权限
3. 退出登录时清除本地存储
```

---

## 树形数据处理

### 扁平结构转树形
```
设计原则：
1. 后端返回扁平数据，便于 CRUD 操作
2. 前端转换为树形，用于展示
3. 提供通用的树形转换工具函数
```

### 树形转换逻辑
```
输入：扁平数组，每项包含 id 和 parentId
输出：嵌套的树形结构，包含 children 数组

步骤：
1. 筛选出指定 parentId 的项
2. 按 sort 字段排序
3. 递归处理每项的 children
4. 移除空的 children 数组
```

---

## 常用组件模式

### 搜索表单
```
组成：
- 输入框（支持 clearable）
- 下拉选择（支持 clearable）
- 日期选择
- 搜索按钮
- 重置按钮
```

### 数据表格
```
功能：
- 列配置
- 排序
- 选择
- 操作列
- 空状态
```

### 分页组件
```
功能：
- 页码切换
- 每页条数切换
- 总数显示
- 快速跳转
```

### 弹窗表单
```
功能：
- 表单验证
- 提交/取消按钮
- 加载状态
- 关闭确认
```

---

## HTTP 请求封装

### 请求拦截器
```
职责：
- 添加认证 Token
- 添加公共请求头
- 请求参数处理
- 请求日志
```

### 响应拦截器
```
职责：
- 统一错误处理
- Token 过期处理
- 响应数据转换
- 响应日志
```

### 错误处理
```
策略：
- 401：跳转登录页
- 403：提示无权限
- 404：提示资源不存在
- 500：提示服务器错误
- 网络错误：提示网络异常
```

---

## 状态管理规范

### Store 设计原则
```
1. 按功能模块拆分 Store
2. 状态应该是响应式的
3. 提供 getter 计算派生状态
4. 提供 action 修改状态
5. 敏感数据需要持久化
```

### 常用 Store 模块
| 模块 | 职责 |
|-----|------|
| user | 用户信息、Token、权限 |
| app | 应用配置、侧边栏状态 |
| permission | 路由权限、菜单 |
| tagsView | 标签页管理 |

---

## 代码规范

### 组件命名
| 类型 | 规范 | 示例 |
|-----|------|-----|
| 页面组件 | PascalCase | UserList.vue |
| 公共组件 | PascalCase | SearchForm.vue |
| 组合式函数 | camelCase + use 前缀 | useUserStore |

### 文件命名
| 类型 | 规范 | 示例 |
|-----|------|-----|
| 组件文件 | PascalCase 或 kebab-case | UserList.vue |
| 工具文件 | camelCase | request.ts |
| 样式文件 | kebab-case | user-list.scss |

### 代码质量
- 组件嵌套不超过三层
- 方法行数不超过 100 行
- 组件行数不超过 500 行
- 抽取公共逻辑为组合式函数

---

## 性能优化

### 组件优化
- 合理使用组件懒加载
- 大列表使用虚拟滚动
- 避免不必要的重渲染
- 使用 memo/computed 缓存计算结果

### 资源优化
- 图片懒加载
- 图片压缩
- 按需引入组件库
- 代码分割

### 网络优化
- 接口防抖/节流
- 请求缓存
- 取消重复请求
- 预加载关键资源

---

## 严格禁止事项

1. **不要在页面中硬编码测试数据**，所有数据必须来自 API 或 Mock
2. **不要在组件中直接操作本地存储**，统一使用 storage 工具
3. **页面组件嵌套不要超过三层**
4. **每个方法行数不超过 100 行**
5. **不要忘记从本地存储恢复权限状态**
6. **不要在循环中发起 HTTP 请求**

---

## 常见问题处理

| 问题 | 解决方案 |
|------|---------|
| 刷新后菜单消失 | 从本地存储恢复权限数据 |
| API 导出错误 | 检查导出方式（具名导出 vs 默认导出） |
| 树形表格不显示 | 检查唯一键和树形配置 |
| 表单验证不生效 | 检查字段名与规则名一致 |
| 路由跳转失效 | 检查路由守卫和权限配置 |
| 状态丢失 | 检查状态持久化配置 |

---

## 代码生成前检查

**强制要求**: 在生成任何业务代码之前，必须先检查是否已有相关的组件或功能。

检查清单:
- [ ] 已查看现有 API 模块
- [ ] 已查看现有组件
- [ ] 已查看现有组合式函数/Hooks
- [ ] 已查看现有 Store
- [ ] 已查看现有工具函数
- [ ] 已确认没有重复或类似的现有功能
