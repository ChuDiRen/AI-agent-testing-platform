---
name: code-review
description: 代码审查技能。审查代码质量、安全性、性能，输出审查报告和改进建议。
---

# Skill: Code Review（代码审查）

## 技能描述

本技能用于审查代码质量，检查安全漏洞、性能问题、代码规范，输出审查报告和改进建议。

## 适用场景

- 功能开发完成后的代码审查
- PR/MR 代码评审
- 代码质量定期检查

## 核心能力

### 1. 代码质量审查
- 代码规范检查
- 代码可读性评估
- 代码复杂度分析

### 2. 安全审查
- SQL注入检测
- XSS漏洞检测
- 敏感信息泄露检查

### 3. 性能审查
- N+1查询检测
- 内存泄漏风险
- 不必要的计算

### 4. 最佳实践审查
- 设计模式应用
- SOLID原则遵循
- 错误处理完整性

## 执行流程

```
1. 获取待审查代码
   ↓
2. 检查代码规范
   ↓
3. 扫描安全漏洞
   ↓
4. 分析性能问题
   ↓
5. 评估代码质量
   ↓
6. 生成审查报告
   ↓
7. 提供改进建议
```

## 审查维度

### 1. 代码规范
| 检查项 | 说明 |
|--------|------|
| 命名规范 | 变量、函数、类命名是否清晰 |
| 注释完整 | 关键逻辑是否有注释 |
| 格式统一 | 缩进、空行、括号风格 |
| 文件组织 | 文件结构是否合理 |

### 2. 代码质量
| 检查项 | 说明 |
|--------|------|
| 单一职责 | 函数/类职责是否单一 |
| 代码重复 | 是否有重复代码 |
| 复杂度 | 圈复杂度是否过高 |
| 可测试性 | 代码是否易于测试 |

### 3. 安全检查
| 检查项 | 风险级别 |
|--------|----------|
| SQL注入 | 🔴 高 |
| XSS攻击 | 🔴 高 |
| 敏感信息硬编码 | 🔴 高 |
| 不安全的反序列化 | 🟠 中 |
| 日志敏感信息 | 🟠 中 |

### 4. 性能检查
| 检查项 | 影响级别 |
|--------|----------|
| N+1查询 | 🔴 高 |
| 无分页查询 | 🔴 高 |
| 同步阻塞操作 | 🟠 中 |
| 不必要的对象创建 | 🟡 低 |

## 输出模板

```markdown
# 代码审查报告

## 审查概览

| 项目 | 内容 |
|------|------|
| 审查范围 | {文件/模块列表} |
| 审查时间 | {时间} |
| 代码行数 | {行数} |
| 总体评级 | ✅ 通过 / ⚠️ 需改进 / ❌ 不通过 |

## 评分卡

| 维度 | 得分 | 说明 |
|------|:----:|------|
| 代码规范 | 8/10 | {简要说明} |
| 代码质量 | 7/10 | {简要说明} |
| 安全性 | 9/10 | {简要说明} |
| 性能 | 8/10 | {简要说明} |
| **综合** | **8/10** | |

## 问题清单

### 🔴 严重问题（必须修复）

#### 问题1：SQL注入风险
- **文件**：`UserService.java:45`
- **问题代码**：
  ```java
  String sql = "SELECT * FROM users WHERE name = '" + name + "'";
  ```
- **风险**：SQL注入攻击
- **修复建议**：
  ```java
  String sql = "SELECT * FROM users WHERE name = ?";
  jdbcTemplate.query(sql, name);
  ```

### 🟠 中等问题（建议修复）

#### 问题2：N+1查询
- **文件**：`OrderService.java:78`
- **问题描述**：在循环中查询关联数据
- **修复建议**：使用JOIN或批量查询

### 🟡 轻微问题（可选优化）

#### 问题3：魔法数字
- **文件**：`Constants.java:23`
- **问题描述**：硬编码数字30
- **修复建议**：提取为命名常量

## 优点

- {优点1}
- {优点2}
- {优点3}

## 改进建议

### 短期改进
1. {建议1}
2. {建议2}

### 长期改进
1. {建议1}
2. {建议2}

## 审查结论

{总结性评价}

**审查结果**：✅ 通过 / ⚠️ 条件通过（修复严重问题后）/ ❌ 不通过
```

## 语言特定检查

### Java/Spring Boot
| 检查项 | 说明 |
|--------|------|
| @Transactional使用 | 事务边界是否正确 |
| 依赖注入 | 是否使用构造器注入 |
| 异常处理 | 是否有全局异常处理 |
| 日志记录 | 日志级别是否合理 |

### Vue3/TypeScript
| 检查项 | 说明 |
|--------|------|
| Composition API | 是否正确使用 |
| 类型定义 | 是否有完整类型 |
| 响应式 | ref/reactive使用是否正确 |
| 组件拆分 | 组件粒度是否合理 |

### Python/FastAPI
| 检查项 | 说明 |
|--------|------|
| 类型注解 | 是否有完整类型注解 |
| 异步处理 | async/await使用是否正确 |
| 依赖注入 | Depends使用是否合理 |
| Pydantic模型 | 数据验证是否完整 |

## 质量检查清单

- [ ] 无严重安全漏洞
- [ ] 无明显性能问题
- [ ] 代码规范一致
- [ ] 关键逻辑有注释
- [ ] 错误处理完整
- [ ] 日志记录合理

## 注意事项

1. **优先级明确**：严重问题必须修复，轻微问题可选
2. **建设性反馈**：指出问题同时提供解决方案
3. **具体定位**：精确到文件和行号
4. **代码示例**：用代码展示正确做法
