<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../apitest/common.css">
    <title>消息通知管理 - 静态原型</title>
</head>

<body class="proto-container">
    <div class="proto-header">
        <h1 class="proto-title">消息机器人管理</h1>
        <button class="proto-btn proto-btn-primary" onclick="window.location.href='form.html'">+ 添加机器人</button>
    </div>

    <div class="proto-card">
        <table class="proto-table">
            <thead>
                <tr>
                    <th>机器人别名</th>
                    <th>类型</th>
                    <th>Webhook URL</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody id="robotListBody">
            </tbody>
        </table>
    </div>

    <script src="../apitest/proto-logic.js"></script>
    <script>
        ProtoStorage.initSeed('Robot', [
            { id: 6001, robot_name: '研发告警机器人', robot_type: 2, webhook_url: 'https://oapi.dingtalk.com/robot/send?access_token=...', is_enabled: 1 },
            { id: 6002, robot_name: '线上事故通知', robot_type: 1, webhook_url: 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=...', is_enabled: 1 }
        ]);

        const typeMap = { 1: '企业微信', 2: '钉钉', 3: '飞书' };

        function renderList() {
            const items = ProtoService.list('Robot');
            const tbody = document.getElementById('robotListBody');

            tbody.innerHTML = items.map(r => `
                <tr>
                    <td style="font-weight: 600;">${r.robot_name}</td>
                    <td><span class="proto-badge" style="background: #f1f5f9;">${typeMap[r.robot_type]}</span></td>
                    <td><code style="font-size: 12px; color: #64748b;">${r.webhook_url.substring(0, 40)}...</code></td>
                    <td>
                        <div class="status-tag">
                            <span class="dot ${r.is_enabled ? 'dot-success' : 'dot-danger'}"></span> 
                            ${r.is_enabled ? '已启用' : '已禁用'}
                        </div>
                    </td>
                    <td>
                        <a href="form.html?id=${r.id}" style="color: #4f46e5; text-decoration: none;">编辑</a> 
                        <span style="color: #e2e8f0;">|</span> 
                        <a href="javascript:void(0)" onclick="handleDelete(${r.id})" style="color: #ef4444; text-decoration: none;">删除</a>
                    </td>
                </tr>
            `).join('');
        }

        function handleDelete(id) {
            if (confirm('确定移除该机器人吗？')) {
                ProtoService.delete('Robot', id);
                ProtoUI.toast('机器人已移除');
                renderList();
            }
        }
        renderList();
    </script>
</body>

</html>