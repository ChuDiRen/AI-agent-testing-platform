<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¶ˆæ¯æ¨¡æ¿ - æ¶ˆæ¯ç®¡ç†</title>
    <link rel="stylesheet" href="../common.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4f46e5;
            --primary-light: #6366f1;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --bg: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            min-height: 100vh;
            animation: pageEnter 0.5s ease-out;
        }

        @keyframes pageEnter {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes cardSlide {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes statPop {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes templateSlide {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .page-container {
            padding: 32px;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* é¡µé¢å¤´éƒ¨ */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            animation: cardSlide 0.4s ease-out;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: #1e293b;
        }

        .page-subtitle {
            color: #64748b;
            font-size: 14px;
            margin-top: 4px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #475569;
            border: 1px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #f8fafc;
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s;
            animation: statPop 0.5s ease-out backwards;
        }

        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.15s; }
        .stat-card:nth-child(3) { animation-delay: 0.2s; }
        .stat-card:nth-child(4) { animation-delay: 0.25s; }
        .stat-card:nth-child(5) { animation-delay: 0.3s; }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08);
        }

        .stat-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            margin-bottom: 14px;
        }

        .stat-icon.total { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); }
        .stat-icon.text { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .stat-icon.markdown { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .stat-icon.card { background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); }
        .stat-icon.active { background: linear-gradient(135deg, var(--success) 0%, #059669 100%); }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #1e293b;
        }

        .stat-label {
            font-size: 13px;
            color: #64748b;
            margin-top: 4px;
        }

        /* ç­›é€‰æ  */
        .filter-bar {
            background: white;
            border-radius: 16px;
            padding: 20px 24px;
            margin-bottom: 24px;
            border: 1px solid #e2e8f0;
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
            animation: cardSlide 0.5s ease-out 0.2s backwards;
        }

        .filter-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-label {
            font-size: 14px;
            color: #64748b;
            font-weight: 500;
        }

        .filter-select, .filter-input {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            min-width: 150px;
            transition: all 0.2s;
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        /* æ¨¡æ¿åˆ—è¡¨ */
        .template-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .template-card {
            background: white;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            overflow: hidden;
            transition: all 0.3s;
            animation: templateSlide 0.5s ease-out backwards;
        }

        .template-card:nth-child(1) { animation-delay: 0.1s; }
        .template-card:nth-child(2) { animation-delay: 0.15s; }
        .template-card:nth-child(3) { animation-delay: 0.2s; }
        .template-card:nth-child(4) { animation-delay: 0.25s; }
        .template-card:nth-child(5) { animation-delay: 0.3s; }

        .template-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08);
            border-color: var(--primary);
        }

        .template-card-main {
            display: flex;
            padding: 24px;
            gap: 24px;
        }

        .template-icon {
            width: 64px;
            height: 64px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            flex-shrink: 0;
        }

        .template-icon.text { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); }
        .template-icon.markdown { background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); }
        .template-icon.card { background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); }

        .template-content {
            flex: 1;
            min-width: 0;
        }

        .template-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .template-name {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
        }

        .template-code {
            font-size: 12px;
            font-family: 'Monaco', 'Consolas', monospace;
            background: #f1f5f9;
            color: #64748b;
            padding: 4px 10px;
            border-radius: 6px;
        }

        .template-badges {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .badge {
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 6px;
            font-weight: 600;
        }

        .badge-text { background: #dbeafe; color: #2563eb; }
        .badge-markdown { background: #ede9fe; color: #7c3aed; }
        .badge-card { background: #fce7f3; color: #db2777; }
        .badge-wechat { background: #dcfce7; color: #16a34a; }
        .badge-dingtalk { background: #dbeafe; color: #2563eb; }
        .badge-feishu { background: #e0e7ff; color: #4f46e5; }
        .badge-enabled { background: #dcfce7; color: #16a34a; }
        .badge-disabled { background: #f1f5f9; color: #64748b; }

        .template-desc {
            font-size: 14px;
            color: #64748b;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .template-preview {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 16px;
            font-size: 13px;
            font-family: 'Monaco', 'Consolas', monospace;
            color: #475569;
            max-height: 120px;
            overflow: hidden;
            position: relative;
        }

        .template-preview::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(transparent, #f8fafc);
        }

        .template-meta {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 16px 24px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: #64748b;
        }

        .meta-item .icon {
            font-size: 16px;
        }

        .template-actions {
            margin-left: auto;
            display: flex;
            gap: 8px;
        }

        /* å˜é‡æ ‡ç­¾ */
        .variable-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .variable-tag {
            font-size: 11px;
            padding: 3px 8px;
            background: #fef3c7;
            color: #b45309;
            border-radius: 4px;
            font-family: 'Monaco', 'Consolas', monospace;
        }

        /* æ¨¡æ€æ¡† */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 20px;
            width: 720px;
            max-width: 90vw;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            animation: modalIn 0.3s ease-out;
        }

        .modal.large {
            width: 900px;
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95) translateY(-20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        @keyframes modalOverlayIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-overlay.active {
            display: flex;
            animation: modalOverlayIn 0.2s ease-out;
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #1e293b;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            border: none;
            background: #f1f5f9;
            cursor: pointer;
            font-size: 18px;
            color: #64748b;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: #e2e8f0;
            color: #1e293b;
        }

        .modal-body {
            padding: 24px;
            max-height: 65vh;
            overflow-y: auto;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-label .required {
            color: var(--danger);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 150px;
            font-family: 'Monaco', 'Consolas', monospace;
        }

        .form-hint {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 6px;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: #f8fafc;
        }

        /* é¢„è§ˆé¢æ¿ */
        .preview-panel {
            background: #1e293b;
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
        }

        .preview-panel-title {
            font-size: 12px;
            color: #94a3b8;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .preview-content {
            background: #0f172a;
            border-radius: 8px;
            padding: 16px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 13px;
            color: #e2e8f0;
            white-space: pre-wrap;
            line-height: 1.6;
        }

        .preview-content .variable {
            color: #fbbf24;
            background: rgba(251, 191, 36, 0.2);
            padding: 1px 4px;
            border-radius: 3px;
        }

        /* å˜é‡é…ç½® */
        .variables-section {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            margin-top: 12px;
        }

        .variables-title {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .variable-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .variable-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        .variable-item input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 13px;
        }

        .variable-item input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .variable-item .remove-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: none;
            background: #fee2e2;
            color: var(--danger);
            cursor: pointer;
            font-size: 14px;
        }

        .add-variable-btn {
            width: 100%;
            padding: 10px;
            border: 2px dashed #e2e8f0;
            border-radius: 8px;
            background: transparent;
            color: #64748b;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .add-variable-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: #f8fafc;
        }

        /* æ¶ˆæ¯ç±»å‹é€‰æ‹©å™¨ */
        .msg-type-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .msg-type-option {
            padding: 20px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .msg-type-option:hover {
            border-color: var(--primary);
            background: #f8fafc;
        }

        .msg-type-option.selected {
            border-color: var(--primary);
            background: #eef2ff;
        }

        .msg-type-option .icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .msg-type-option .name {
            font-size: 14px;
            font-weight: 600;
            color: #1e293b;
        }

        .msg-type-option .desc {
            font-size: 12px;
            color: #64748b;
            margin-top: 4px;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="page-container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="page-header">
            <div>
                <h1 class="page-title">ğŸ“ æ¶ˆæ¯æ¨¡æ¿</h1>
                <p class="page-subtitle">ç®¡ç†æµ‹è¯•é€šçŸ¥ã€å‘Šè­¦ç­‰æ¶ˆæ¯æ¨¡æ¿ï¼Œæ”¯æŒå˜é‡æ›¿æ¢</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="location.href='robot.html'">
                    ğŸ¤– æœºå™¨äººé…ç½®
                </button>
                <button class="btn btn-secondary" onclick="location.href='send.html'">
                    ğŸ“¤ å‘é€æµ‹è¯•
                </button>
                <button class="btn btn-primary" onclick="openCreateModal()">
                    â• æ–°å»ºæ¨¡æ¿
                </button>
            </div>
        </div>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon total">ğŸ“</div>
                <div class="stat-value">12</div>
                <div class="stat-label">æ¨¡æ¿æ€»æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon text">ğŸ“„</div>
                <div class="stat-value">5</div>
                <div class="stat-label">æ–‡æœ¬æ¶ˆæ¯</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon markdown">ğŸ“‹</div>
                <div class="stat-value">4</div>
                <div class="stat-label">Markdown</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon card">ğŸ´</div>
                <div class="stat-value">3</div>
                <div class="stat-label">å¡ç‰‡æ¶ˆæ¯</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon active">âœ…</div>
                <div class="stat-value">10</div>
                <div class="stat-label">å·²å¯ç”¨</div>
            </div>
        </div>

        <!-- ç­›é€‰æ  -->
        <div class="filter-bar">
            <div class="filter-item">
                <span class="filter-label">æ¶ˆæ¯ç±»å‹</span>
                <select class="filter-select" id="filterType">
                    <option value="">å…¨éƒ¨ç±»å‹</option>
                    <option value="text">æ–‡æœ¬æ¶ˆæ¯</option>
                    <option value="markdown">Markdown</option>
                    <option value="card">å¡ç‰‡æ¶ˆæ¯</option>
                </select>
            </div>
            <div class="filter-item">
                <span class="filter-label">å…³è”æœºå™¨äºº</span>
                <select class="filter-select" id="filterRobot">
                    <option value="">å…¨éƒ¨æœºå™¨äºº</option>
                    <option value="1">æµ‹è¯•ç»“æœé€šçŸ¥ç¾¤</option>
                    <option value="2">ç ”å‘å‘Šè­¦ç¾¤</option>
                    <option value="3">äº§å“æ—¥æŠ¥ç¾¤</option>
                </select>
            </div>
            <div class="filter-item">
                <span class="filter-label">çŠ¶æ€</span>
                <select class="filter-select" id="filterStatus">
                    <option value="">å…¨éƒ¨çŠ¶æ€</option>
                    <option value="enabled">å·²å¯ç”¨</option>
                    <option value="disabled">å·²ç¦ç”¨</option>
                </select>
            </div>
            <div class="filter-item">
                <input type="text" class="filter-input" placeholder="æœç´¢æ¨¡æ¿åç§°..." id="searchInput">
            </div>
            <button class="btn btn-secondary btn-sm" onclick="filterTemplates()">ğŸ” æœç´¢</button>
        </div>

        <!-- æ¨¡æ¿åˆ—è¡¨ -->
        <div class="template-list">
            <!-- æµ‹è¯•å®Œæˆé€šçŸ¥æ¨¡æ¿ -->
            <div class="template-card">
                <div class="template-card-main">
                    <div class="template-icon markdown">ğŸ“‹</div>
                    <div class="template-content">
                        <div class="template-header">
                            <span class="template-name">æµ‹è¯•æ‰§è¡Œå®Œæˆé€šçŸ¥</span>
                            <span class="template-code">TEST_COMPLETE</span>
                        </div>
                        <div class="template-badges">
                            <span class="badge badge-markdown">Markdown</span>
                            <span class="badge badge-wechat">ä¼ä¸šå¾®ä¿¡</span>
                            <span class="badge badge-enabled">å·²å¯ç”¨</span>
                        </div>
                        <div class="template-desc">
                            æµ‹è¯•è®¡åˆ’æ‰§è¡Œå®Œæˆåè‡ªåŠ¨å‘é€çš„é€šçŸ¥æ¶ˆæ¯ï¼ŒåŒ…å«æ‰§è¡Œç»“æœç»Ÿè®¡å’ŒæŠ¥å‘Šé“¾æ¥ã€‚
                        </div>
                        <div class="template-preview">## ğŸ§ª æµ‹è¯•æ‰§è¡Œå®Œæˆ

**é¡¹ç›®**: {{project_name}}
**è®¡åˆ’**: {{plan_name}}
**æ‰§è¡Œæ—¶é—´**: {{exec_time}}

### ğŸ“Š æ‰§è¡Œç»“æœ
- âœ… é€šè¿‡: {{pass_count}} ä¸ª
- âŒ å¤±è´¥: {{fail_count}} ä¸ª
- â­ï¸ è·³è¿‡: {{skip_count}} ä¸ª
- ğŸ“ˆ é€šè¿‡ç‡: {{pass_rate}}%

[ğŸ“„ æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š]({{report_url}})</div>
                        <div class="variable-tags">
                            <span class="variable-tag">{{project_name}}</span>
                            <span class="variable-tag">{{plan_name}}</span>
                            <span class="variable-tag">{{pass_count}}</span>
                            <span class="variable-tag">{{fail_count}}</span>
                            <span class="variable-tag">{{pass_rate}}</span>
                            <span class="variable-tag">{{report_url}}</span>
                        </div>
                    </div>
                </div>
                <div class="template-meta">
                    <span class="meta-item"><span class="icon">ğŸ¤–</span> æµ‹è¯•ç»“æœé€šçŸ¥ç¾¤</span>
                    <span class="meta-item"><span class="icon">ğŸ“…</span> 2025-12-01 åˆ›å»º</span>
                    <span class="meta-item"><span class="icon">ğŸ“¤</span> å·²å‘é€ 156 æ¬¡</span>
                    <div class="template-actions">
                        <button class="btn btn-secondary btn-sm" onclick="previewTemplate(1)">ğŸ‘ï¸ é¢„è§ˆ</button>
                        <button class="btn btn-success btn-sm" onclick="sendTemplate(1)">ğŸ“¤ å‘é€</button>
                        <button class="btn btn-secondary btn-sm" onclick="editTemplate(1)">âœï¸ ç¼–è¾‘</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteTemplate(1)">ğŸ—‘ï¸</button>
                    </div>
                </div>
            </div>

            <!-- æµ‹è¯•å¤±è´¥å‘Šè­¦æ¨¡æ¿ -->
            <div class="template-card">
                <div class="template-card-main">
                    <div class="template-icon markdown">ğŸ“‹</div>
                    <div class="template-content">
                        <div class="template-header">
                            <span class="template-name">æµ‹è¯•å¤±è´¥å‘Šè­¦</span>
                            <span class="template-code">TEST_FAIL_ALERT</span>
                        </div>
                        <div class="template-badges">
                            <span class="badge badge-markdown">Markdown</span>
                            <span class="badge badge-dingtalk">é’‰é’‰</span>
                            <span class="badge badge-enabled">å·²å¯ç”¨</span>
                        </div>
                        <div class="template-desc">
                            å½“æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå¤±è´¥æ—¶è§¦å‘çš„å‘Šè­¦é€šçŸ¥ï¼ŒåŒ…å«å¤±è´¥è¯¦æƒ…å’Œé”™è¯¯ä¿¡æ¯ã€‚
                        </div>
                        <div class="template-preview">## âš ï¸ æµ‹è¯•å¤±è´¥å‘Šè­¦

**ç”¨ä¾‹åç§°**: {{case_name}}
**å¤±è´¥åŸå› **: {{error_msg}}
**æ‰§è¡Œæ—¶é—´**: {{exec_time}}

### ğŸ“ å¤±è´¥è¯¦æƒ…
```
{{error_detail}}
```

@{{owner}} è¯·åŠæ—¶å¤„ç†ï¼</div>
                        <div class="variable-tags">
                            <span class="variable-tag">{{case_name}}</span>
                            <span class="variable-tag">{{error_msg}}</span>
                            <span class="variable-tag">{{error_detail}}</span>
                            <span class="variable-tag">{{owner}}</span>
                        </div>
                    </div>
                </div>
                <div class="template-meta">
                    <span class="meta-item"><span class="icon">ğŸ¤–</span> ç ”å‘å‘Šè­¦ç¾¤</span>
                    <span class="meta-item"><span class="icon">ğŸ“…</span> 2025-12-05 åˆ›å»º</span>
                    <span class="meta-item"><span class="icon">ğŸ“¤</span> å·²å‘é€ 42 æ¬¡</span>
                    <div class="template-actions">
                        <button class="btn btn-secondary btn-sm" onclick="previewTemplate(2)">ğŸ‘ï¸ é¢„è§ˆ</button>
                        <button class="btn btn-success btn-sm" onclick="sendTemplate(2)">ğŸ“¤ å‘é€</button>
                        <button class="btn btn-secondary btn-sm" onclick="editTemplate(2)">âœï¸ ç¼–è¾‘</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteTemplate(2)">ğŸ—‘ï¸</button>
                    </div>
                </div>
            </div>

            <!-- æ¯æ—¥æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿ -->
            <div class="template-card">
                <div class="template-card-main">
                    <div class="template-icon card">ğŸ´</div>
                    <div class="template-content">
                        <div class="template-header">
                            <span class="template-name">æ¯æ—¥æµ‹è¯•æŠ¥å‘Š</span>
                            <span class="template-code">DAILY_REPORT</span>
                        </div>
                        <div class="template-badges">
                            <span class="badge badge-card">å¡ç‰‡æ¶ˆæ¯</span>
                            <span class="badge badge-feishu">é£ä¹¦</span>
                            <span class="badge badge-enabled">å·²å¯ç”¨</span>
                        </div>
                        <div class="template-desc">
                            æ¯æ—¥å®šæ—¶å‘é€çš„æµ‹è¯•æ±‡æ€»æŠ¥å‘Šï¼ŒåŒ…å«å½“æ—¥æ‰€æœ‰é¡¹ç›®çš„æµ‹è¯•æ‰§è¡Œæƒ…å†µã€‚
                        </div>
                        <div class="template-preview">{
  "msg_type": "interactive",
  "card": {
    "header": {
      "title": { "tag": "plain_text", "content": "ğŸ“Š æ¯æ—¥æµ‹è¯•æŠ¥å‘Š" }
    },
    "elements": [
      { "tag": "div", "text": { "content": "æ—¥æœŸ: {{date}}" } },
      { "tag": "div", "text": { "content": "æ‰§è¡Œæ€»æ•°: {{total}}" } }
    ]
  }
}</div>
                        <div class="variable-tags">
                            <span class="variable-tag">{{date}}</span>
                            <span class="variable-tag">{{total}}</span>
                            <span class="variable-tag">{{pass_rate}}</span>
                        </div>
                    </div>
                </div>
                <div class="template-meta">
                    <span class="meta-item"><span class="icon">ğŸ¤–</span> äº§å“æ—¥æŠ¥ç¾¤</span>
                    <span class="meta-item"><span class="icon">ğŸ“…</span> 2025-12-10 åˆ›å»º</span>
                    <span class="meta-item"><span class="icon">ğŸ“¤</span> å·²å‘é€ 28 æ¬¡</span>
                    <div class="template-actions">
                        <button class="btn btn-secondary btn-sm" onclick="previewTemplate(3)">ğŸ‘ï¸ é¢„è§ˆ</button>
                        <button class="btn btn-success btn-sm" onclick="sendTemplate(3)">ğŸ“¤ å‘é€</button>
                        <button class="btn btn-secondary btn-sm" onclick="editTemplate(3)">âœï¸ ç¼–è¾‘</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteTemplate(3)">ğŸ—‘ï¸</button>
                    </div>
                </div>
            </div>

            <!-- ç®€å•æ–‡æœ¬é€šçŸ¥ -->
            <div class="template-card">
                <div class="template-card-main">
                    <div class="template-icon text">ğŸ“„</div>
                    <div class="template-content">
                        <div class="template-header">
                            <span class="template-name">ç®€å•æ–‡æœ¬é€šçŸ¥</span>
                            <span class="template-code">SIMPLE_NOTIFY</span>
                        </div>
                        <div class="template-badges">
                            <span class="badge badge-text">æ–‡æœ¬æ¶ˆæ¯</span>
                            <span class="badge badge-wechat">ä¼ä¸šå¾®ä¿¡</span>
                            <span class="badge badge-enabled">å·²å¯ç”¨</span>
                        </div>
                        <div class="template-desc">
                            é€šç”¨çš„ç®€å•æ–‡æœ¬é€šçŸ¥æ¨¡æ¿ï¼Œé€‚ç”¨äºå¿«é€Ÿå‘é€æé†’æ¶ˆæ¯ã€‚
                        </div>
                        <div class="template-preview">ã€{{title}}ã€‘

{{content}}

å‘é€æ—¶é—´: {{time}}</div>
                        <div class="variable-tags">
                            <span class="variable-tag">{{title}}</span>
                            <span class="variable-tag">{{content}}</span>
                            <span class="variable-tag">{{time}}</span>
                        </div>
                    </div>
                </div>
                <div class="template-meta">
                    <span class="meta-item"><span class="icon">ğŸ¤–</span> æµ‹è¯•ç»“æœé€šçŸ¥ç¾¤</span>
                    <span class="meta-item"><span class="icon">ğŸ“…</span> 2025-12-15 åˆ›å»º</span>
                    <span class="meta-item"><span class="icon">ğŸ“¤</span> å·²å‘é€ 89 æ¬¡</span>
                    <div class="template-actions">
                        <button class="btn btn-secondary btn-sm" onclick="previewTemplate(4)">ğŸ‘ï¸ é¢„è§ˆ</button>
                        <button class="btn btn-success btn-sm" onclick="sendTemplate(4)">ğŸ“¤ å‘é€</button>
                        <button class="btn btn-secondary btn-sm" onclick="editTemplate(4)">âœï¸ ç¼–è¾‘</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteTemplate(4)">ğŸ—‘ï¸</button>
                    </div>
                </div>
            </div>

            <!-- CI/CD æ„å»ºé€šçŸ¥ -->
            <div class="template-card">
                <div class="template-card-main">
                    <div class="template-icon markdown">ğŸ“‹</div>
                    <div class="template-content">
                        <div class="template-header">
                            <span class="template-name">CI/CD æ„å»ºé€šçŸ¥</span>
                            <span class="template-code">CICD_BUILD</span>
                        </div>
                        <div class="template-badges">
                            <span class="badge badge-markdown">Markdown</span>
                            <span class="badge badge-feishu">é£ä¹¦</span>
                            <span class="badge badge-disabled">å·²ç¦ç”¨</span>
                        </div>
                        <div class="template-desc">
                            CI/CD æµæ°´çº¿æ„å»ºå®Œæˆåçš„é€šçŸ¥æ¶ˆæ¯ï¼ŒåŒ…å«æ„å»ºçŠ¶æ€å’Œéƒ¨ç½²ä¿¡æ¯ã€‚
                        </div>
                        <div class="template-preview">## ğŸ”§ CI/CD æ„å»ºé€šçŸ¥

**é¡¹ç›®**: {{project}}
**åˆ†æ”¯**: {{branch}}
**çŠ¶æ€**: {{status}}
**æäº¤**: {{commit_msg}}

æ„å»ºè€—æ—¶: {{duration}}</div>
                        <div class="variable-tags">
                            <span class="variable-tag">{{project}}</span>
                            <span class="variable-tag">{{branch}}</span>
                            <span class="variable-tag">{{status}}</span>
                            <span class="variable-tag">{{commit_msg}}</span>
                        </div>
                    </div>
                </div>
                <div class="template-meta">
                    <span class="meta-item"><span class="icon">ğŸ¤–</span> CI/CD é€šçŸ¥ç¾¤</span>
                    <span class="meta-item"><span class="icon">ğŸ“…</span> 2025-12-20 åˆ›å»º</span>
                    <span class="meta-item"><span class="icon">ğŸ“¤</span> å·²å‘é€ 0 æ¬¡</span>
                    <div class="template-actions">
                        <button class="btn btn-warning btn-sm" onclick="enableTemplate(5)">âœ… å¯ç”¨</button>
                        <button class="btn btn-secondary btn-sm" onclick="editTemplate(5)">âœï¸ ç¼–è¾‘</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteTemplate(5)">ğŸ—‘ï¸</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–°å»º/ç¼–è¾‘æ¨¡æ¿æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="templateModal">
        <div class="modal large">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">æ–°å»ºæ¶ˆæ¯æ¨¡æ¿</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">æ¶ˆæ¯ç±»å‹ <span class="required">*</span></label>
                    <div class="msg-type-selector">
                        <div class="msg-type-option selected" data-type="text" onclick="selectMsgType('text')">
                            <div class="icon">ğŸ“„</div>
                            <div class="name">æ–‡æœ¬æ¶ˆæ¯</div>
                            <div class="desc">çº¯æ–‡æœ¬æ ¼å¼</div>
                        </div>
                        <div class="msg-type-option" data-type="markdown" onclick="selectMsgType('markdown')">
                            <div class="icon">ğŸ“‹</div>
                            <div class="name">Markdown</div>
                            <div class="desc">æ”¯æŒå¯Œæ–‡æœ¬</div>
                        </div>
                        <div class="msg-type-option" data-type="card" onclick="selectMsgType('card')">
                            <div class="icon">ğŸ´</div>
                            <div class="name">å¡ç‰‡æ¶ˆæ¯</div>
                            <div class="desc">JSON ç»“æ„</div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">æ¨¡æ¿åç§° <span class="required">*</span></label>
                        <input type="text" class="form-input" id="templateName" placeholder="ä¾‹å¦‚ï¼šæµ‹è¯•å®Œæˆé€šçŸ¥">
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ¨¡æ¿ç¼–ç  <span class="required">*</span></label>
                        <input type="text" class="form-input" id="templateCode" placeholder="ä¾‹å¦‚ï¼šTEST_COMPLETE">
                        <p class="form-hint">å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºç¨‹åºè°ƒç”¨</p>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">å…³è”æœºå™¨äºº <span class="required">*</span></label>
                        <select class="form-select" id="robotId">
                            <option value="">è¯·é€‰æ‹©æœºå™¨äºº</option>
                            <option value="1">æµ‹è¯•ç»“æœé€šçŸ¥ç¾¤ (ä¼ä¸šå¾®ä¿¡)</option>
                            <option value="2">ç ”å‘å‘Šè­¦ç¾¤ (é’‰é’‰)</option>
                            <option value="3">äº§å“æ—¥æŠ¥ç¾¤ (é£ä¹¦)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">çŠ¶æ€</label>
                        <select class="form-select" id="templateStatus">
                            <option value="1">å¯ç”¨</option>
                            <option value="0">ç¦ç”¨</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">æè¿°è¯´æ˜</label>
                    <input type="text" class="form-input" id="templateDesc" placeholder="ç®€è¦æè¿°æ¨¡æ¿ç”¨é€”">
                </div>

                <div class="form-group">
                    <label class="form-label">æ¨¡æ¿å†…å®¹ <span class="required">*</span></label>
                    <textarea class="form-textarea" id="templateContent" placeholder="è¾“å…¥æ¨¡æ¿å†…å®¹ï¼Œä½¿ç”¨ {{å˜é‡å}} æ ¼å¼å®šä¹‰å˜é‡...">## ğŸ§ª æµ‹è¯•æ‰§è¡Œå®Œæˆ

**é¡¹ç›®**: {{project_name}}
**è®¡åˆ’**: {{plan_name}}

### ğŸ“Š æ‰§è¡Œç»“æœ
- âœ… é€šè¿‡: {{pass_count}} ä¸ª
- âŒ å¤±è´¥: {{fail_count}} ä¸ª

[ğŸ“„ æŸ¥çœ‹æŠ¥å‘Š]({{report_url}})</textarea>
                    <p class="form-hint">ä½¿ç”¨ {{å˜é‡å}} æ ¼å¼å®šä¹‰å¯æ›¿æ¢å˜é‡</p>
                </div>

                <div class="variables-section">
                    <div class="variables-title">
                        ğŸ·ï¸ å˜é‡é…ç½®
                        <span style="font-weight: normal; color: #94a3b8; font-size: 12px;">ï¼ˆå®šä¹‰æ¨¡æ¿ä¸­ä½¿ç”¨çš„å˜é‡ï¼‰</span>
                    </div>
                    <div class="variable-list" id="variableList">
                        <div class="variable-item">
                            <input type="text" placeholder="å˜é‡å" value="project_name">
                            <input type="text" placeholder="å˜é‡è¯´æ˜" value="é¡¹ç›®åç§°">
                            <button class="remove-btn" onclick="removeVariable(this)">Ã—</button>
                        </div>
                        <div class="variable-item">
                            <input type="text" placeholder="å˜é‡å" value="plan_name">
                            <input type="text" placeholder="å˜é‡è¯´æ˜" value="æµ‹è¯•è®¡åˆ’åç§°">
                            <button class="remove-btn" onclick="removeVariable(this)">Ã—</button>
                        </div>
                        <div class="variable-item">
                            <input type="text" placeholder="å˜é‡å" value="pass_count">
                            <input type="text" placeholder="å˜é‡è¯´æ˜" value="é€šè¿‡ç”¨ä¾‹æ•°">
                            <button class="remove-btn" onclick="removeVariable(this)">Ã—</button>
                        </div>
                    </div>
                    <button class="add-variable-btn" onclick="addVariable()">+ æ·»åŠ å˜é‡</button>
                </div>

                <!-- å®æ—¶é¢„è§ˆ -->
                <div class="preview-panel">
                    <div class="preview-panel-title">ğŸ“± å®æ—¶é¢„è§ˆ</div>
                    <div class="preview-content" id="previewContent">## ğŸ§ª æµ‹è¯•æ‰§è¡Œå®Œæˆ

**é¡¹ç›®**: <span class="variable">{{project_name}}</span>
**è®¡åˆ’**: <span class="variable">{{plan_name}}</span>

### ğŸ“Š æ‰§è¡Œç»“æœ
- âœ… é€šè¿‡: <span class="variable">{{pass_count}}</span> ä¸ª
- âŒ å¤±è´¥: <span class="variable">{{fail_count}}</span> ä¸ª

[ğŸ“„ æŸ¥çœ‹æŠ¥å‘Š](<span class="variable">{{report_url}}</span>)</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveTemplate()">ğŸ’¾ ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- é¢„è§ˆæ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="previewModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">æ¨¡æ¿é¢„è§ˆ</h3>
                <button class="modal-close" onclick="closePreviewModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">å¡«å†™æµ‹è¯•å˜é‡</label>
                    <div id="previewVariables"></div>
                </div>
                <div class="preview-panel">
                    <div class="preview-panel-title">ğŸ“± æ¸²æŸ“ç»“æœ</div>
                    <div class="preview-content" id="renderedContent"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePreviewModal()">å…³é—­</button>
                <button class="btn btn-success" onclick="sendFromPreview()">ğŸ“¤ å‘é€æ­¤æ¶ˆæ¯</button>
            </div>
        </div>
    </div>

    <script src="../proto-logic.js"></script>
    <script>
        let selectedMsgType = 'text';
        let editingTemplateId = null;

        function openCreateModal() {
            editingTemplateId = null;
            document.getElementById('modalTitle').textContent = 'æ–°å»ºæ¶ˆæ¯æ¨¡æ¿';
            document.getElementById('templateName').value = '';
            document.getElementById('templateCode').value = '';
            document.getElementById('robotId').value = '';
            document.getElementById('templateDesc').value = '';
            document.getElementById('templateContent').value = '';
            selectMsgType('text');
            document.getElementById('templateModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('templateModal').classList.remove('active');
        }

        function selectMsgType(type) {
            selectedMsgType = type;
            document.querySelectorAll('.msg-type-option').forEach(el => {
                el.classList.remove('selected');
                if (el.dataset.type === type) {
                    el.classList.add('selected');
                }
            });
        }

        function editTemplate(id) {
            editingTemplateId = id;
            document.getElementById('modalTitle').textContent = 'ç¼–è¾‘æ¶ˆæ¯æ¨¡æ¿';
            // æ¨¡æ‹ŸåŠ è½½æ•°æ®
            document.getElementById('templateName').value = 'æµ‹è¯•æ‰§è¡Œå®Œæˆé€šçŸ¥';
            document.getElementById('templateCode').value = 'TEST_COMPLETE';
            document.getElementById('robotId').value = '1';
            document.getElementById('templateDesc').value = 'æµ‹è¯•è®¡åˆ’æ‰§è¡Œå®Œæˆåè‡ªåŠ¨å‘é€çš„é€šçŸ¥æ¶ˆæ¯';
            selectMsgType('markdown');
            document.getElementById('templateModal').classList.add('active');
        }

        function saveTemplate() {
            const name = document.getElementById('templateName').value;
            const code = document.getElementById('templateCode').value;
            const robotId = document.getElementById('robotId').value;
            
            if (!name || !code || !robotId) {
                ProtoUI.toast('è¯·å¡«å†™å¿…å¡«å­—æ®µ', 'error');
                return;
            }

            ProtoUI.toast(editingTemplateId ? 'æ¨¡æ¿æ›´æ–°æˆåŠŸ' : 'æ¨¡æ¿åˆ›å»ºæˆåŠŸ', 'success');
            closeModal();
        }

        function deleteTemplate(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¨¡æ¿å—ï¼Ÿ')) {
                ProtoUI.toast('æ¨¡æ¿å·²åˆ é™¤', 'success');
            }
        }

        function enableTemplate(id) {
            ProtoUI.toast('æ¨¡æ¿å·²å¯ç”¨', 'success');
        }

        function addVariable() {
            const list = document.getElementById('variableList');
            const item = document.createElement('div');
            item.className = 'variable-item';
            item.innerHTML = `
                <input type="text" placeholder="å˜é‡å">
                <input type="text" placeholder="å˜é‡è¯´æ˜">
                <button class="remove-btn" onclick="removeVariable(this)">Ã—</button>
            `;
            list.appendChild(item);
        }

        function removeVariable(btn) {
            btn.parentElement.remove();
        }

        function previewTemplate(id) {
            document.getElementById('previewModal').classList.add('active');
            // æ¨¡æ‹Ÿå˜é‡è¾“å…¥
            document.getElementById('previewVariables').innerHTML = `
                <div class="variable-item">
                    <input type="text" placeholder="project_name" value="APIæµ‹è¯•é¡¹ç›®">
                </div>
                <div class="variable-item">
                    <input type="text" placeholder="plan_name" value="å›å½’æµ‹è¯•è®¡åˆ’">
                </div>
                <div class="variable-item">
                    <input type="text" placeholder="pass_count" value="45">
                </div>
                <div class="variable-item">
                    <input type="text" placeholder="fail_count" value="3">
                </div>
            `;
            document.getElementById('renderedContent').innerHTML = `## ğŸ§ª æµ‹è¯•æ‰§è¡Œå®Œæˆ

**é¡¹ç›®**: APIæµ‹è¯•é¡¹ç›®
**è®¡åˆ’**: å›å½’æµ‹è¯•è®¡åˆ’

### ğŸ“Š æ‰§è¡Œç»“æœ
- âœ… é€šè¿‡: 45 ä¸ª
- âŒ å¤±è´¥: 3 ä¸ª

[ğŸ“„ æŸ¥çœ‹æŠ¥å‘Š](https://example.com/report/123)`;
        }

        function closePreviewModal() {
            document.getElementById('previewModal').classList.remove('active');
        }

        function sendTemplate(id) {
            ProtoUI.toast('æ­£åœ¨å‘é€æ¶ˆæ¯...', 'success');
            setTimeout(() => {
                ProtoUI.toast('æ¶ˆæ¯å‘é€æˆåŠŸï¼', 'success');
            }, 1000);
        }

        function sendFromPreview() {
            ProtoUI.toast('æ­£åœ¨å‘é€æ¶ˆæ¯...', 'success');
            setTimeout(() => {
                ProtoUI.toast('æ¶ˆæ¯å‘é€æˆåŠŸï¼', 'success');
                closePreviewModal();
            }, 1000);
        }

        function filterTemplates() {
            ProtoUI.toast('ç­›é€‰åŠŸèƒ½æ¼”ç¤º', 'success');
        }

        // å®æ—¶é¢„è§ˆæ›´æ–°
        document.getElementById('templateContent')?.addEventListener('input', function() {
            const content = this.value;
            const highlighted = content.replace(/\{\{(\w+)\}\}/g, '<span class="variable">{{$1}}</span>');
            document.getElementById('previewContent').innerHTML = highlighted;
        });
    </script>
</body>

</html>
