<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../common.css">
    <title>æµ‹è¯•è®¡åˆ’ç®¡ç† - é™æ€åŸå‹</title>
</head>

<body class="proto-container">
    <div class="proto-header">
        <h1 class="proto-title">æµ‹è¯•è®¡åˆ’ç®¡ç†</h1>
    </div>

    <div class="proto-card">
        <!-- Unified Toolbar -->
        <div
            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #f1f5f9;">
            <div style="display: flex; gap: 12px;">
                <input type="text" id="searchInput" class="proto-input" style="width: 300px;" placeholder="æœç´¢è®¡åˆ’åç§°/æè¿°..."
                    onkeyup="renderList()">
                <button class="proto-btn proto-btn-secondary">ğŸ” æœç´¢</button>
            </div>
            <button class="proto-btn proto-btn-primary" onclick="window.location.href='form.html'">+ æ–°å»ºè®¡åˆ’</button>
        </div>

        <table class="proto-table">
            <thead>
                <tr>
                    <th>è®¡åˆ’åç§°</th>
                    <th>è®¡åˆ’æè¿°</th>
                    <th>æ‰€å±é¡¹ç›®</th>
                    <th>åˆ›å»ºæ—¶é—´</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="collectionListBody">
            </tbody>
        </table>

        <!-- Pagination -->
        <div
            style="display: flex; justify-content: flex-end; align-items: center; margin-top: 20px; gap: 12px; color: #64748b; font-size: 14px;">
            <span>å…± 12 æ¡</span>
            <button class="proto-btn proto-btn-secondary" disabled>ä¸Šä¸€é¡µ</button>
            <span style="font-weight: 600; color: #4f46e5;">1</span>
            <button class="proto-btn proto-btn-secondary">ä¸‹ä¸€é¡µ</button>
        </div>
    </div>

    <script src="../proto-logic.js"></script>
    <script>
        ProtoStorage.initSeed('ApiCollection', [
            { id: 4001, collection_name: 'V1.0å†’çƒŸæµ‹è¯•', collection_desc: 'æ ¸å¿ƒåŠŸèƒ½å›å½’', project_id: 1001, create_time: '2025-01-01' },
            { id: 4002, collection_name: 'æ”¯ä»˜æ¨¡å—ä¸“é¡¹', collection_desc: 'æ”¯ä»˜æµç¨‹æ·±åº¦æµ‹è¯•', project_id: 1001, create_time: '2025-01-02' }
        ]);

        function renderList() {
            const keyword = document.getElementById('searchInput').value.toLowerCase();
            const collections = ProtoService.list('ApiCollection').filter(item =>
                item.collection_name.toLowerCase().includes(keyword) ||
                (item.collection_desc && item.collection_desc.toLowerCase().includes(keyword))
            );
            const projects = ProtoService.list('Project');
            const tbody = document.getElementById('collectionListBody');

            tbody.innerHTML = collections.map(c => {
                const project = projects.find(p => p.id == c.project_id);
                return `
                    <tr>
                        <td style="font-weight: 500;">${c.collection_name}</td>
                        <td style="color: #64748b;">${c.collection_desc || '-'}</td>
                        <td>${project ? project.project_name : 'æœªçŸ¥é¡¹ç›®'}</td>
                        <td style="font-size: 13px; color: #94a3b8;">${c.create_time || '-'}</td>
                        <td>
                            <a href="form.html?id=${c.id}" style="color: #4f46e5; text-decoration: none;">ç¼–è¾‘</a> 
                            <span style="color: #e2e8f0;">|</span>
                            <a href="report.html?id=${c.id}" style="color: #059669; text-decoration: none;">æŠ¥å‘Š</a> 
                            <span style="color: #e2e8f0;">|</span> 
                            <a href="javascript:void(0)" onclick="handleDelete(${c.id})" style="color: #ef4444; text-decoration: none;">åˆ é™¤</a>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function handleDelete(id) {
            if (confirm('ç¡®å®šåˆ é™¤è¯¥è®¡åˆ’å—ï¼Ÿ')) {
                ProtoService.delete('ApiCollection', id);
                ProtoUI.toast('è®¡åˆ’å·²åˆ é™¤');
                renderList();
            }
        }
        renderList();
    </script>
</body>

</html>