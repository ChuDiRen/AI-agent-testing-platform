<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../common.css">
    <title>测试计划报告 - 静态原型</title>
    <!-- Mock ECharts via a simple placeholder or CDN if allowed, but strict local preferred. We will use CSS/SVG headers for simple charts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
</head>

<body class="proto-container">
    <div class="proto-header">
        <h1 class="proto-title">测试计划执行报告</h1>
        <button class="proto-btn proto-btn-secondary" onclick="window.location.href='index.html'">返回列表</button>
    </div>

    <div class="proto-card" style="margin-bottom: 24px;">
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; text-align: center;">
            <div style="padding: 20px; background: #f8fafc; border-radius: 8px;">
                <p style="color: #64748b; font-size: 14px;">总执行次数</p>
                <h2 style="font-size: 32px; color: #0f172a; margin: 10px 0;">24</h2>
            </div>
            <div style="padding: 20px; background: #f8fafc; border-radius: 8px;">
                <p style="color: #64748b; font-size: 14px;">最近一次用例数</p>
                <h2 style="font-size: 32px; color: #3b82f6; margin: 10px 0;">158</h2>
            </div>
            <div style="padding: 20px; background: #f8fafc; border-radius: 8px;">
                <p style="color: #64748b; font-size: 14px;">总体通过率</p>
                <h2 style="font-size: 32px; color: #10b981; margin: 10px 0;">92%</h2>
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
        <div class="proto-card" style="height: 400px;">
            <h3 style="margin-bottom: 20px;">执行结果趋势 (Bar Chart)</h3>
            <div id="barChart" style="width: 100%; height: 320px;"></div>
        </div>
        <div class="proto-card" style="height: 400px;">
            <h3 style="margin-bottom: 20px;">执行耗时趋势 (Line Chart)</h3>
            <div id="lineChart" style="width: 100%; height: 320px;"></div>
        </div>
    </div>

    <div class="proto-card">
        <h3 style="margin-bottom: 20px;">Top 5 失败用例</h3>
        <table class="proto-table">
            <thead>
                <tr>
                    <th>用例名称</th>
                    <th>失败次数</th>
                    <th>最后失败时间</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>用户登录接口 - 异常参数</td>
                    <td><span style="color: #ef4444; font-weight: bold;">12</span></td>
                    <td>2025-01-05 14:20:11</td>
                </tr>
                <tr>
                    <td>订单创建 - 库存不足</td>
                    <td><span style="color: #ef4444; font-weight: bold;">8</span></td>
                    <td>2025-01-04 09:11:30</td>
                </tr>
                <tr>
                    <td>支付回调 - 签名错误</td>
                    <td><span style="color: #ef4444; font-weight: bold;">5</span></td>
                    <td>2025-01-03 11:22:45</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script src="../proto-logic.js"></script>
    <script>
        const id = getUrlParam('id');
        if (!id) {
            ProtoUI.toast('未指定计划ID', 'error');
        }

        // Initialize Charts
        const barChart = echarts.init(document.getElementById('barChart'));
        const lineChart = echarts.init(document.getElementById('lineChart'));

        const optionBar = {
            tooltip: { trigger: 'axis' },
            legend: { data: ['通过', '失败'] },
            xAxis: { data: ['Run #20', 'Run #21', 'Run #22', 'Run #23', 'Run #24'] },
            yAxis: {},
            series: [
                { name: '通过', type: 'bar', data: [120, 132, 101, 134, 150], itemStyle: { color: '#10b981' } },
                { name: '失败', type: 'bar', data: [20, 12, 11, 14, 8], itemStyle: { color: '#ef4444' } }
            ]
        };

        const optionLine = {
            tooltip: { trigger: 'axis' },
            xAxis: { type: 'category', data: ['Run #20', 'Run #21', 'Run #22', 'Run #23', 'Run #24'] },
            yAxis: { type: 'value', name: 'ms' },
            series: [{ data: [820, 932, 901, 934, 1290], type: 'line', smooth: true, itemStyle: { color: '#3b82f6' } }]
        };

        barChart.setOption(optionBar);
        lineChart.setOption(optionLine);

        // Resize handling
        window.addEventListener('resize', () => {
            barChart.resize();
            lineChart.resize();
        });
    </script>
</body>

</html>